generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Accounts {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refreshToken      String?
  accessToken       String?
  expiresAt         Int?
  tokenType         String?
  scope             String?
  idToken           String?
  sessionState      String?
  users             Users   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@map("accounts")
}

model AuditLogs {
  id         String   @id @default(uuid())
  userId     String?
  action     String
  entityType String
  entityId   String
  timestamp  DateTime @default(now())
  oldValues  Json?
  newValues  Json?
  metadata   Json?
  tableName  String?
  recordId   String?
  changes    Json?
  details    Json?
  users      Users?   @relation(fields: [userId], references: [id])

  @@map("audit_logs")
}

model BenefitTypes {
  id                     String                 @id @default(uuid())
  name                   String                 @unique
  description            String?
  type                   String
  createdAt              DateTime               @default(now())
  defaultAmount          Decimal?               @db.Decimal(12, 2)
  isActive               Boolean                @default(true)
  isPercentage           Boolean                @default(false)
  updatedAt              DateTime               @default(now())
  contract_benefits      ContractBenefits[]
  employee_benefits      EmployeeBenefits[]
  payroll_entry_benefits PayrollEntryBenefits[]

  @@map("benefit_types")
}

model BusinessAccounts {
  id         String     @id @default(uuid())
  businessId String     @unique
  balance    Decimal    @default(0) @db.Decimal(12, 2)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime
  createdBy  String?
  businesses Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)
  users      Users?     @relation(fields: [createdBy], references: [id])

  @@map("business_accounts")
}

model BusinessBrands {
  id                String             @id @default(uuid())
  businessId        String
  name              String
  description       String?
  logoUrl           String?
  website           String?
  isActive          Boolean            @default(true)
  businessType      String
  attributes        Json?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  businesses        Businesses         @relation(fields: [businessId], references: [id])
  business_products BusinessProducts[]

  @@unique([businessId, name])
  @@map("business_brands")
}

model BusinessCategories {
  id                        String                   @id @default(uuid())
  businessId                String?
  name                      String
  description               String?
  parentId                  String?
  displayOrder              Int                      @default(0)
  isActive                  Boolean                  @default(true)
  businessType              String
  attributes                Json?
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime
  color                     String                   @default("#3B82F6")
  createdBy                 String?
  domainId                  String?
  emoji                     String                   @default("ðŸ“¦")
  isUserCreated             Boolean                  @default(false)
  businesses                Businesses?              @relation(fields: [businessId], references: [id])
  users                     Users?                   @relation("CategoryCreatedBy", fields: [createdBy], references: [id])
  domain                    InventoryDomains?        @relation(fields: [domainId], references: [id])
  business_categories       BusinessCategories?      @relation("business_categoriesTobusiness_categories", fields: [parentId], references: [id])
  other_business_categories BusinessCategories[]     @relation("business_categoriesTobusiness_categories")
  business_products         BusinessProducts[]
  inventory_subcategories   InventorySubcategories[]

  @@unique([businessType, domainId, name])
  @@index([businessType])
  @@map("business_categories")
}

model BusinessCustomers {
  id              String           @id @default(uuid())
  businessId      String
  customerNumber  String
  name            String
  email           String?
  phone           String?
  dateOfBirth     DateTime?
  address         String?
  city            String?
  country         String?
  customerType    CustomerType     @default(INDIVIDUAL)
  segment         String?
  loyaltyPoints   Int              @default(0)
  totalSpent      Decimal          @default(0) @db.Decimal(12, 2)
  isActive        Boolean          @default(true)
  businessType    String
  attributes      Json?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  businesses      Businesses       @relation(fields: [businessId], references: [id])
  business_orders BusinessOrders[]
  customer_laybys CustomerLayby[]

  @@unique([businessId, customerNumber])
  @@map("business_customers")
}

model BusinessMemberships {
  id                   String               @id @default(uuid())
  userId               String
  businessId           String
  role                 String               @default("employee")
  permissions          Json                 @default("{}")
  isActive             Boolean              @default(true)
  invitedBy            String?
  joinedAt             DateTime             @default(now())
  lastAccessedAt       DateTime?
  templateId           String?
  businesses           Businesses           @relation(fields: [businessId], references: [id], onDelete: Cascade)
  permission_templates PermissionTemplates? @relation(fields: [templateId], references: [id])
  users                Users                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, businessId])
  @@map("business_memberships")
}

model BusinessOrderItems {
  id               String           @id @default(uuid())
  orderId          String
  productVariantId String?
  quantity         Int
  unitPrice        Decimal          @db.Decimal(10, 2)
  discountAmount   Decimal          @default(0) @db.Decimal(10, 2)
  totalPrice       Decimal          @db.Decimal(10, 2)
  attributes       Json?
  createdAt        DateTime         @default(now())
  business_orders  BusinessOrders   @relation(fields: [orderId], references: [id])
  product_variants ProductVariants? @relation(fields: [productVariantId], references: [id])

  @@map("business_order_items")
}

model BusinessOrders {
  id                       String                   @id @default(uuid())
  businessId               String
  orderNumber              String
  customerId               String?
  employeeId               String?
  orderType                OrderType                @default(SALE)
  status                   OrderStatus              @default(PENDING)
  subtotal                 Decimal                  @db.Decimal(10, 2)
  taxAmount                Decimal                  @db.Decimal(10, 2)
  discountAmount           Decimal                  @default(0) @db.Decimal(10, 2)
  totalAmount              Decimal                  @db.Decimal(10, 2)
  paymentMethod            PaymentMethod?
  paymentStatus            PaymentStatus            @default(PENDING)
  businessType             String
  attributes               Json?
  notes                    String?
  processedAt              DateTime?
  transactionDate          DateTime?
  isManualEntry            Boolean                  @default(false)
  manualEntryNote          String?
  createdBy                String?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  business_order_items     BusinessOrderItems[]
  businesses               Businesses               @relation(fields: [businessId], references: [id])
  business_customers       BusinessCustomers?       @relation(fields: [customerId], references: [id])
  employees                Employees?               @relation(fields: [employeeId], references: [id])
  creator                  Users?                   @relation("BusinessOrderCreator", fields: [createdBy], references: [id])
  reprint_logs             ReprintLog[]
  coupon_usages            CouponUsages[]
  meal_program_transaction MealProgramTransactions?

  @@unique([businessId, orderNumber])
  @@index([orderNumber])
  @@index([businessId, createdAt(sort: Desc)])
  @@index([customerId, createdAt(sort: Desc)])
  @@index([businessId, transactionDate])
  @@index([createdBy])
  @@map("business_orders")
}

model BusinessProducts {
  id                          String                     @id @default(uuid())
  businessId                  String
  name                        String
  description                 String?
  sku                         String?
  barcode                     String?
  brandId                     String?
  categoryId                  String
  productType                 ProductType                @default(PHYSICAL)
  condition                   ProductCondition           @default(NEW)
  basePrice                   Decimal                    @db.Decimal(10, 2)
  costPrice                   Decimal?                   @db.Decimal(10, 2)
  isActive                    Boolean                    @default(true)
  businessType                String
  attributes                  Json?
  isAvailable                 Boolean                    @default(true)
  spiceLevel                  Int?                       @default(0)
  dietaryRestrictions         String[]
  allergens                   String[]
  preparationTime             Int?                       @default(0)
  calories                    Int?
  isCombo                     Boolean                    @default(false)
  comboItemsData              Json?
  originalPrice               Decimal?                   @db.Decimal(10, 2)
  discountPercent             Decimal?                   @db.Decimal(5, 2)
  discountAmount              Decimal?                   @db.Decimal(10, 2)
  promotionStartDate          DateTime?
  promotionEndDate            DateTime?
  promotionName               String?
  createdAt                   DateTime                   @default(now())
  updatedAt                   DateTime
  locationId                  String?
  subcategoryId               String?
  supplierId                  String?
  requiresCompanionItem       Boolean                    @default(false)
  business_brands             BusinessBrands?            @relation(fields: [brandId], references: [id])
  businesses                  Businesses                 @relation(fields: [businessId], references: [id])
  business_categories         BusinessCategories         @relation(fields: [categoryId], references: [id])
  business_locations          BusinessLocations?         @relation("ProductLocation", fields: [locationId], references: [id])
  inventory_subcategory       InventorySubcategories?    @relation(fields: [subcategoryId], references: [id])
  business_suppliers          BusinessSuppliers?         @relation("ProductSupplier", fields: [supplierId], references: [id])
  business_stock_movements    BusinessStockMovements[]
  menu_combo_items            MenuComboItems[]
  product_attributes          ProductAttributes[]
  product_barcodes            ProductBarcodes[]
  product_images              ProductImages[]
  product_price_changes       product_price_changes[]
  product_variants            ProductVariants[]
  supplier_products           SupplierProducts[]
  meal_program_eligible_items MealProgramEligibleItems[]

  @@unique([businessId, sku])
  @@map("business_products")
}

model BusinessStockMovements {
  id                String            @id @default(uuid())
  businessId        String
  productVariantId  String
  movementType      StockMovementType
  quantity          Int
  unitCost          Decimal?          @db.Decimal(10, 2)
  reference         String?
  reason            String?
  employeeId        String?
  businessType      String
  attributes        Json?
  createdAt         DateTime          @default(now())
  businessProductId String?
  businesses        Businesses        @relation(fields: [businessId], references: [id])
  business_products BusinessProducts? @relation(fields: [businessProductId], references: [id])
  employees         Employees?        @relation(fields: [employeeId], references: [id])
  product_variants  ProductVariants   @relation(fields: [productVariantId], references: [id])

  @@map("business_stock_movements")
}

model BusinessSuppliers {
  id                String             @id @default(uuid())
  businessId        String?
  supplierNumber    String
  name              String
  contactPerson     String?
  email             String?
  phone             String?
  address           String?
  paymentTerms      String?
  creditLimit       Decimal?           @db.Decimal(12, 2)
  isActive          Boolean            @default(true)
  businessType      String
  attributes        Json?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  accountBalance    Decimal?           @default(0) @db.Decimal(12, 2)
  emoji             String?
  notes             String?
  taxId             String?
  productsSupplied  String?
  business_products         BusinessProducts[]         @relation("ProductSupplier")
  businesses                Businesses?                @relation(fields: [businessId], references: [id])
  supplier_products         SupplierProducts[]
  expense_account_payments  ExpenseAccountPayments[]   @relation("ExpensePaymentPayeeSupplier")

  @@unique([businessType, supplierNumber])
  @@map("business_suppliers")
}

model BusinessLocations {
  id                String              @id @default(uuid())
  businessId        String
  locationCode      String
  name              String
  emoji             String?
  description       String?
  locationType      String?
  capacity          Int?
  isActive          Boolean             @default(true)
  parentLocationId  String?
  attributes        Json?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  businesses        Businesses          @relation(fields: [businessId], references: [id])
  parent_location   BusinessLocations?  @relation("LocationHierarchy", fields: [parentLocationId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  child_locations   BusinessLocations[] @relation("LocationHierarchy")
  business_products BusinessProducts[]  @relation("ProductLocation")

  @@unique([businessId, locationCode])
  @@map("business_locations")
}

model BusinessTransactions {
  id            String     @id @default(uuid())
  businessId    String
  amount        Decimal    @db.Decimal(12, 2)
  type          String
  description   String
  referenceId   String?
  referenceType String?
  balanceAfter  Decimal    @db.Decimal(12, 2)
  createdAt     DateTime   @default(now())
  createdBy     String
  notes         String?
  metadata      Json?
  businesses    Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)
  users         Users      @relation(fields: [createdBy], references: [id])

  @@map("business_transactions")
}

model Businesses {
  id                                                                       String                        @id @default(uuid())
  name                                                                     String
  type                                                                     String
  description                                                              String?
  isActive                                                                 Boolean                       @default(true)
  settings                                                                 Json                          @default("{}")
  createdBy                                                                String?
  createdAt                                                                DateTime                      @default(now())
  updatedAt                                                                DateTime                      @default(now())
  umbrellaBusinessId                                                       String?
  isUmbrellaBusiness                                                       Boolean                       @default(false)
  umbrellaBusinessName                                                     String?                       @default("Demo Umbrella Company")
  umbrellaBusinessAddress                                                  String?
  umbrellaBusinessEmail                                                    String?
  umbrellaBusinessPhone                                                    String?
  umbrellaBusinessRegistration                                             String?
  shortName                                                                String?
  isDemo                                                                   Boolean                       @default(false)
  wifiIntegrationEnabled                                                   Boolean                       @default(false)
  sku_format                                                               String?                       @default("{BUSINESS}-{SEQ}") @db.VarChar(50)
  sku_prefix                                                               String?                       @db.VarChar(20)
  sku_digits                                                               Int?                          @default(5)
  address                                                                  String?
  phone                                                                    String?
  ecocashEnabled                                                           Boolean                       @default(false)
  couponsEnabled                                                           Boolean                       @default(false)
  receiptReturnPolicy                                                      String?
  taxEnabled                                                               Boolean                       @default(false)
  taxIncludedInPrice                                                       Boolean                       @default(true)
  taxRate                                                                  Decimal?                      @db.Decimal(5, 2)
  taxLabel                                                                 String?
  defaultPage                                                              String?                       @db.VarChar(50)
  slogan                                                                   String?                       @default("Where Customer Is King") @db.VarChar(200)
  showSlogan                                                               Boolean                       @default(true)
  barcode_inventory_items                                                  BarcodeInventoryItems[]
  barcode_print_jobs                                                       BarcodePrintJobs[]
  barcode_templates                                                        BarcodeTemplates[]
  business_accounts                                                        BusinessAccounts?
  business_brands                                                          BusinessBrands[]
  business_categories                                                      BusinessCategories[]
  business_customers                                                       BusinessCustomers[]
  business_locations                                                       BusinessLocations[]
  business_memberships                                                     BusinessMemberships[]
  business_orders                                                          BusinessOrders[]
  business_products                                                        BusinessProducts[]
  business_stock_movements                                                 BusinessStockMovements[]
  business_suppliers                                                       BusinessSuppliers[]
  business_token_menu_items                                                BusinessTokenMenuItems[]
  business_transactions                                                    BusinessTransactions[]
  businesses                                                               Businesses?                   @relation("businessesTobusinesses", fields: [umbrellaBusinessId], references: [id])
  other_businesses                                                         Businesses[]                  @relation("businessesTobusinesses")
  customer_display_ads                                                     CustomerDisplayAd[]
  customer_display_sessions                                                CustomerDisplaySession[]
  customer_laybys                                                          CustomerLayby[]
  pos_terminal_configs                                                     PosTerminalConfig[]
  device_connection_history                                                DeviceConnectionHistory[]
  device_registry_first_seen                                               DeviceRegistry[]              @relation("DeviceFirstSeenBusiness")
  device_registry_last_seen                                                DeviceRegistry[]              @relation("DeviceLastSeenBusiness")
  employee_business_assignments                                            EmployeeBusinessAssignments[]
  employee_contracts_employee_contracts_primaryBusinessIdTobusinesses      EmployeeContracts[]           @relation("employee_contracts_primaryBusinessIdTobusinesses")
  employee_contracts_employee_contracts_umbrellaBusinessIdTobusinesses     EmployeeContracts[]           @relation("employee_contracts_umbrellaBusinessIdTobusinesses")
  employees                                                                Employees[]
  esp32_connected_clients                                                  ESP32ConnectedClients[]
  expense_accounts                                                         ExpenseAccounts[]             @relation("BusinessExpenseAccounts")
  expense_account_deposits                                                 ExpenseAccountDeposits[]      @relation("ExpenseAccountDepositSource")
  expense_account_payments_as_payee                                        ExpenseAccountPayments[]      @relation("ExpensePaymentPayeeBusiness")
  inter_business_loans_inter_business_loans_borrowerBusinessIdTobusinesses InterBusinessLoans[]          @relation("inter_business_loans_borrowerBusinessIdTobusinesses")
  inter_business_loans_inter_business_loans_lenderBusinessIdTobusinesses   InterBusinessLoans[]          @relation("inter_business_loans_lenderBusinessIdTobusinesses")
  mac_acl_entries                                                          MacAclEntry[]
  menu_combos                                                              MenuCombos[]
  menu_promotions                                                          MenuPromotions[]
  payroll_account_deposits                                                 PayrollAccountDeposits[]
  payroll_accounts                                                         PayrollAccounts?
  payroll_exports                                                          PayrollExports[]
  payroll_periods                                                          PayrollPeriods[]
  portal_integrations                                                      PortalIntegrations?
  print_jobs                                                               PrintJobs[]
  product_barcodes                                                         ProductBarcodes[]
  projects                                                                 Projects[]
  r710_business_integrations                                               R710BusinessIntegrations[]    @relation("R710BusinessIntegration")
  r710_business_token_menu_items                                           R710BusinessTokenMenuItems[]
  r710_connected_clients                                                   R710ConnectedClients[]
  r710_sync_logs                                                           R710SyncLogs[]
  r710_token_configs                                                       R710TokenConfigs[]            @relation("R710TokenConfigToBusiness")
  r710_token_sales                                                         R710TokenSales[]              @relation("R710TokenSaleToBusiness")
  r710_tokens                                                              R710Tokens[]                  @relation("R710TokenToBusiness")
  r710_wlans                                                               R710Wlans[]                   @relation("R710WlanToBusiness")
  reprint_logs                                                             ReprintLog[]
  saved_reports                                                            SavedReports[]
  seed_data_templates                                                      SeedDataTemplates[]
  sku_sequences                                                            sku_sequences[]
  vehicle_expenses                                                         VehicleExpenses[]
  vehicle_reimbursements                                                   VehicleReimbursements[]
  vehicle_trips                                                            VehicleTrips[]
  vehicles                                                                 Vehicles[]
  wifi_token_sales                                                         WifiTokenSales[]
  wifi_tokens                                                              WifiTokens[]
  wifi_usage_analytics                                                     WiFiUsageAnalytics[]
  coupons                                                                  Coupons[]
  inventory_transfers_source                                               InventoryTransfers[]          @relation("TransferSource")
  inventory_transfers_target                                               InventoryTransfers[]          @relation("TransferTarget")
  clothing_bales                                                           ClothingBales[]
  meal_program_participants                                                MealProgramParticipants[]
  meal_program_eligible_items                                              MealProgramEligibleItems[]
  meal_program_transactions                                                MealProgramTransactions[]

  @@map("businesses")
}

model ReceiptSequences {
  businessId   String
  date         String
  lastSequence Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@id([businessId, date])
  @@map("receipt_sequences")
}

model SavedReports {
  id          String   @id @default(cuid())
  businessId  String
  reportType  String // 'END_OF_DAY' | 'END_OF_WEEK' | 'END_OF_MONTH'
  reportDate  DateTime @db.Date // Business day date
  periodStart DateTime // Start of period
  periodEnd   DateTime // End of period

  // Snapshot data (JSON)
  reportData Json // Complete report data snapshot

  // Manager sign-off
  managerName   String
  managerUserId String? // Link to user if logged in
  signedAt      DateTime

  // Till reconciliation (for day reports)
  expectedCash Decimal? @db.Decimal(10, 2)
  cashCounted  Decimal? @db.Decimal(10, 2)
  variance     Decimal? @db.Decimal(10, 2)

  // Summary metrics (for quick queries)
  totalSales     Decimal @db.Decimal(10, 2)
  totalOrders    Int
  receiptsIssued Int

  // Metadata
  createdAt DateTime @default(now())
  createdBy String
  isLocked  Boolean  @default(true) // Locked reports cannot be edited

  // Relations
  business Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)
  user     Users?     @relation(fields: [managerUserId], references: [id])

  @@unique([businessId, reportType, reportDate])
  @@index([businessId, reportType, reportDate])
  @@index([reportDate])
  @@index([businessId])
  @@map("saved_reports")
}

model ChatMessages {
  id         String     @id @default(uuid())
  message    String
  createdAt  DateTime   @default(now())
  roomId     String?
  userId     String?
  chat_rooms ChatRooms? @relation(fields: [roomId], references: [id], onDelete: Cascade)
  users      Users?     @relation(fields: [userId], references: [id])

  @@map("chat_messages")
}

model ChatParticipants {
  id         String     @id @default(uuid())
  joinedAt   DateTime   @default(now())
  roomId     String?
  userId     String?
  chat_rooms ChatRooms? @relation(fields: [roomId], references: [id], onDelete: Cascade)
  users      Users?     @relation(fields: [userId], references: [id])

  @@map("chat_participants")
}

model ChatRooms {
  id                String             @id @default(uuid())
  name              String
  type              String             @default("group")
  createdAt         DateTime           @default(now())
  createdBy         String?
  chat_messages     ChatMessages[]
  chat_participants ChatParticipants[]
  users             Users?             @relation(fields: [createdBy], references: [id])

  @@map("chat_rooms")
}

model CompensationTypes {
  id                   String              @id @default(uuid())
  name                 String              @unique
  type                 String
  description          String?
  baseAmount           Decimal?            @db.Decimal(12, 2)
  commissionPercentage Decimal?            @db.Decimal(5, 2)
  createdAt            DateTime            @default(now())
  isActive             Boolean             @default(true)
  updatedAt            DateTime            @default(now())
  frequency            String?             @default("monthly")
  employee_contracts   EmployeeContracts[]
  employees            Employees[]

  @@map("compensation_types")
}

model ConflictResolutions {
  id                 String             @id @default(uuid())
  conflictType       ConflictType
  resolutionStrategy ResolutionStrategy
  sourceEventId      String
  targetEventId      String?
  resolvedData       Json
  resolvedBy         String?
  resolvedAt         DateTime           @default(now())
  eventIds           String[]           @default([])
  resolution         Json?
  strategy           String?
  metadata           Json?
  createdAt          DateTime           @default(now())

  @@map("conflict_resolutions")
}

model ConstructionExpenses {
  id                    String                @id @default(uuid())
  category              String
  description           String
  amount                Decimal               @db.Decimal(12, 2)
  vendor                String?
  createdAt             DateTime              @default(now())
  createdBy             String?
  projectId             String?
  receiptUrl            String?
  users                 Users?                @relation(fields: [createdBy], references: [id])
  construction_projects ConstructionProjects? @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@map("construction_expenses")
}

model ConstructionProjects {
  id                    String                 @id @default(uuid())
  name                  String
  description           String?
  status                String                 @default("active")
  budget                Decimal?               @db.Decimal(12, 2)
  createdAt             DateTime               @default(now())
  createdBy             String?
  endDate               DateTime?
  startDate             DateTime?
  updatedAt             DateTime               @default(now())
  businessType          String                 @default("construction")
  projectTypeId         String?
  construction_expenses ConstructionExpenses[]
  users                 Users?                 @relation(fields: [createdBy], references: [id])
  project_types         ProjectTypes?          @relation(fields: [projectTypeId], references: [id])
  project_contractors   ProjectContractors[]
  project_stages        ProjectStages[]
  project_transactions  ProjectTransactions[]

  @@map("construction_projects")
}

model ContractBenefits {
  id                 String            @id @default(uuid())
  amount             Decimal           @db.Decimal(12, 2)
  notes              String?
  benefitTypeId      String
  contractId         String
  createdAt          DateTime          @default(now())
  isPercentage       Boolean           @default(false)
  benefit_types      BenefitTypes      @relation(fields: [benefitTypeId], references: [id])
  employee_contracts EmployeeContracts @relation(fields: [contractId], references: [id], onDelete: Cascade)

  @@map("contract_benefits")
}

model ContractRenewals {
  id                                                                          String             @id @default(uuid())
  status                                                                      String             @default("pending")
  notes                                                                       String?
  autoRenewalMonths                                                           Int?
  benefitChanges                                                              Json?
  createdAt                                                                   DateTime           @default(now())
  employeeId                                                                  String
  isAutoRenewal                                                               Boolean            @default(false)
  jobTitleChange                                                              String?
  managerNotifiedAt                                                           DateTime?
  newContractId                                                               String?
  originalContractId                                                          String
  processedAt                                                                 DateTime?
  processedBy                                                                 String?
  reminderSentAt                                                              DateTime?
  renewalDueDate                                                              DateTime
  salaryChange                                                                Decimal?           @db.Decimal(12, 2)
  salaryChangeType                                                            String?
  updatedAt                                                                   DateTime           @default(now())
  employees                                                                   Employees          @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  employee_contracts_contract_renewals_newContractIdToemployee_contracts      EmployeeContracts? @relation("contract_renewals_newContractIdToemployee_contracts", fields: [newContractId], references: [id])
  employee_contracts_contract_renewals_originalContractIdToemployee_contracts EmployeeContracts  @relation("contract_renewals_originalContractIdToemployee_contracts", fields: [originalContractId], references: [id])

  @@map("contract_renewals")
}

model CustomerLayby {
  id                   String                 @id @default(cuid())
  laybyNumber          String                 @unique
  businessId           String
  customerId           String?
  status               LaybyStatus            @default(ACTIVE)
  totalAmount          Decimal                @db.Decimal(12, 2)
  depositAmount        Decimal                @db.Decimal(12, 2)
  depositPercent       Decimal                @db.Decimal(5, 2)
  balanceRemaining     Decimal                @db.Decimal(12, 2)
  totalPaid            Decimal                @default(0) @db.Decimal(12, 2)
  installmentAmount    Decimal?               @db.Decimal(12, 2)
  installmentFrequency InstallmentFrequency?
  paymentDueDate       DateTime?
  completionDueDate    DateTime?
  serviceFee           Decimal                @default(0) @db.Decimal(12, 2)
  lateFee              Decimal                @default(0) @db.Decimal(12, 2)
  administrationFee    Decimal                @default(0) @db.Decimal(12, 2)
  totalFees            Decimal                @default(0) @db.Decimal(12, 2)
  items                Json
  itemsReleased        Boolean                @default(false)
  itemsReleasedAt      DateTime?
  itemsReleasedBy      String?
  notes                String?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime               @updatedAt
  createdBy            String
  completedAt          DateTime?
  cancelledAt          DateTime?
  cancellationReason   String?
  cancellationRefund   Decimal?               @db.Decimal(12, 2)
  payments             CustomerLaybyPayment[]
  business             Businesses             @relation(fields: [businessId], references: [id])
  creator              Users                  @relation("CustomerLaybyCreator", fields: [createdBy], references: [id])
  customer             BusinessCustomers?     @relation(fields: [customerId], references: [id])

  @@index([businessId])
  @@index([customerId])
  @@index([status])
  @@map("customer_laybys")
}

model CustomerLaybyPayment {
  id                String                 @id @default(cuid())
  laybyId           String
  receiptNumber     String                 @unique
  amount            Decimal                @db.Decimal(12, 2)
  paymentMethod     PaymentMethod
  paymentReference  String?
  paymentDate       DateTime               @default(now())
  processedBy       String
  notes             String?
  isRefund          Boolean                @default(false)
  refundedPaymentId String?
  layby             CustomerLayby          @relation(fields: [laybyId], references: [id], onDelete: Cascade)
  processor         Users                  @relation("CustomerLaybyPaymentProcessor", fields: [processedBy], references: [id])
  refundedPayment   CustomerLaybyPayment?  @relation("RefundRelation", fields: [refundedPaymentId], references: [id])
  refunds           CustomerLaybyPayment[] @relation("RefundRelation")

  @@index([laybyId])
  @@map("customer_layby_payments")
}

model DataSnapshots {
  id                  String   @id @default(uuid())
  nodeId              String
  tableName           String
  recordId            String
  snapshotData        Json
  advanceBreakdown    Json?
  advanceDeductions   Decimal  @default(0) @db.Decimal(12, 2)
  deductionsBreakdown Json?
  expectedWorkDays    Int?
  hasAdjustments      Boolean?
  isProRata           Boolean?
  loanBreakdown       Json?
  loanDeductions      Decimal  @default(0) @db.Decimal(12, 2)
  proRataCalculation  Json?
  proRataReason       String?
  processedBy         String?
  totalDeductions     Decimal  @default(0) @db.Decimal(12, 2)

  @@map("data_snapshots")
}

model DisciplinaryActions {
  id                                                   String    @id @default(uuid())
  employeeId                                           String
  actionType                                           String
  violationType                                        String
  title                                                String
  description                                          String
  incidentDate                                         DateTime
  actionDate                                           DateTime
  severity                                             String    @default("low")
  isActive                                             Boolean   @default(true)
  improvementPlan                                      String?
  followUpDate                                         DateTime?
  followUpNotes                                        String?
  createdBy                                            String
  hrReviewed                                           Boolean   @default(false)
  hrReviewedBy                                         String?
  hrReviewedAt                                         DateTime?
  hrNotes                                              String?
  employeeAcknowledged                                 Boolean   @default(false)
  employeeResponse                                     String?
  employeeSignedAt                                     DateTime?
  attachments                                          String[]
  createdAt                                            DateTime  @default(now())
  updatedAt                                            DateTime  @default(now())
  employees_disciplinary_actions_createdByToemployees  Employees @relation("disciplinary_actions_createdByToemployees", fields: [createdBy], references: [id], map: "disciplinary_actions_created_by_fkey")
  employees_disciplinary_actions_employeeIdToemployees Employees @relation("disciplinary_actions_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade, map: "disciplinary_actions_employee_id_fkey")

  @@map("disciplinary_actions")
}

model DriverAuthorizations {
  id                 String             @id @default(uuid())
  driverId           String
  vehicleId          String
  authorizedBy       String
  authorizedDate     DateTime
  expiryDate         DateTime?
  isActive           Boolean            @default(true)
  authorizationLevel AuthorizationLevel @default(BASIC)
  notes              String?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime
  users              Users              @relation(fields: [authorizedBy], references: [id])
  vehicle_drivers    VehicleDrivers     @relation(fields: [driverId], references: [id], onDelete: Cascade)
  vehicles           Vehicles           @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vehicle_trips      VehicleTrips[]

  @@unique([driverId, vehicleId])
  @@map("driver_authorizations")
}

model DriverLicenseTemplates {
  id             String           @id @default(uuid())
  name           String
  description    String?
  pattern        String
  example        String
  countryCode    String?
  createdAt      DateTime         @default(now())
  isActive       Boolean          @default(true)
  updatedAt      DateTime         @default(now())
  employees      Employees[]
  persons        Persons[]
  vehicleDrivers VehicleDrivers[]

  @@map("driver_license_templates")
}

model EmployeeAllowances {
  id                                                  String     @id @default(uuid())
  employeeId                                          String
  type                                                String
  amount                                              Decimal    @db.Decimal(12, 2)
  description                                         String?
  payrollMonth                                        Int
  payrollYear                                         Int
  approvedBy                                          String?
  approvedAt                                          DateTime?
  createdAt                                           DateTime   @default(now())
  employees_employee_allowances_approvedByToemployees Employees? @relation("employee_allowances_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_allowances_employeeIdToemployees Employees  @relation("employee_allowances_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_allowances")
}

model EmployeeAttendance {
  id          String    @id @default(uuid())
  date        DateTime
  status      String    @default("present")
  notes       String?
  checkIn     DateTime?
  checkOut    DateTime?
  createdAt   DateTime  @default(now())
  employeeId  String
  hoursWorked Decimal?  @db.Decimal(4, 2)
  employees   Employees @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, date])
  @@map("employee_attendance")
}

model EmployeeBenefits {
  id            String       @id @default(uuid())
  amount        Decimal      @db.Decimal(12, 2)
  notes         String?
  benefitTypeId String
  createdAt     DateTime     @default(now())
  effectiveDate DateTime
  employeeId    String
  endDate       DateTime?
  isActive      Boolean      @default(true)
  isPercentage  Boolean      @default(false)
  updatedAt     DateTime     @default(now())
  benefit_types BenefitTypes @relation(fields: [benefitTypeId], references: [id])
  employees     Employees    @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_benefits")
}

model EmployeeBonuses {
  id                                               String     @id @default(uuid())
  amount                                           Decimal    @db.Decimal(12, 2)
  approvedAt                                       DateTime?
  approvedBy                                       String?
  createdAt                                        DateTime   @default(now())
  employeeId                                       String
  reason                                           String?
  type                                             String
  employees_employee_bonuses_approvedByToemployees Employees? @relation("employee_bonuses_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_bonuses_employeeIdToemployees Employees  @relation("employee_bonuses_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_bonuses")
}

model EmployeeBusinessAssignments {
  id         String     @id @default(uuid())
  role       String?
  notes      String?
  assignedBy String?
  businessId String
  createdAt  DateTime   @default(now())
  employeeId String
  endDate    DateTime?
  isActive   Boolean    @default(true)
  isPrimary  Boolean    @default(false)
  startDate  DateTime   @default(now())
  updatedAt  DateTime   @default(now())
  businesses Businesses @relation(fields: [businessId], references: [id])
  employees  Employees  @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, businessId])
  @@map("employee_business_assignments")
}

model EmployeeContracts {
  id                                                                         String              @id @default(uuid())
  version                                                                    Int                 @default(1)
  status                                                                     String              @default("draft")
  notes                                                                      String?
  additionalBusinesses                                                       String[]
  approvedAt                                                                 DateTime?
  approvedBy                                                                 String?
  baseSalary                                                                 Decimal             @db.Decimal(12, 2)
  compensationTypeId                                                         String
  contractNumber                                                             String              @unique
  createdAt                                                                  DateTime            @default(now())
  createdBy                                                                  String?
  customResponsibilities                                                     String?
  employeeId                                                                 String
  employeeSignedAt                                                           DateTime?
  endDate                                                                    DateTime?
  isCommissionBased                                                          Boolean             @default(false)
  isSalaryBased                                                              Boolean             @default(true)
  jobTitleId                                                                 String
  managerSignedAt                                                            DateTime?
  pdfUrl                                                                     String?
  primaryBusinessId                                                          String
  probationPeriodMonths                                                      Int?
  signedPdfUrl                                                               String?
  startDate                                                                  DateTime
  supervisorId                                                               String?
  supervisorName                                                             String?
  supervisorTitle                                                            String?
  updatedAt                                                                  DateTime            @default(now())
  commissionAmount                                                           Decimal?            @db.Decimal(12, 2)
  contractDurationMonths                                                     Int?
  livingAllowance                                                            Decimal?            @db.Decimal(12, 2)
  pdfGenerationData                                                          Json?
  umbrellaBusinessId                                                         String?
  umbrellaBusinessName                                                       String?             @default("Demo Umbrella Company")
  businessAssignments                                                        Json?
  previousContractId                                                         String?
  copiedFromContractId                                                       String?
  isRenewal                                                                  Boolean             @default(false)
  originalContractId                                                         String?
  renewalCount                                                               Int                 @default(0)
  contract_benefits                                                          ContractBenefits[]
  contract_renewals_contract_renewals_newContractIdToemployee_contracts      ContractRenewals[]  @relation("contract_renewals_newContractIdToemployee_contracts")
  contract_renewals_contract_renewals_originalContractIdToemployee_contracts ContractRenewals[]  @relation("contract_renewals_originalContractIdToemployee_contracts")
  compensation_types                                                         CompensationTypes   @relation(fields: [compensationTypeId], references: [id])
  employees_employee_contracts_employeeIdToemployees                         Employees           @relation("employee_contracts_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)
  job_titles                                                                 JobTitles           @relation(fields: [jobTitleId], references: [id])
  employee_contracts                                                         EmployeeContracts?  @relation("employee_contractsToemployee_contracts", fields: [previousContractId], references: [id])
  other_employee_contracts                                                   EmployeeContracts[] @relation("employee_contractsToemployee_contracts")
  businesses_employee_contracts_primaryBusinessIdTobusinesses                Businesses          @relation("employee_contracts_primaryBusinessIdTobusinesses", fields: [primaryBusinessId], references: [id])
  employees_employee_contracts_supervisorIdToemployees                       Employees?          @relation("employee_contracts_supervisorIdToemployees", fields: [supervisorId], references: [id])
  businesses_employee_contracts_umbrellaBusinessIdTobusinesses               Businesses?         @relation("employee_contracts_umbrellaBusinessIdTobusinesses", fields: [umbrellaBusinessId], references: [id])

  @@map("employee_contracts")
}

model EmployeeDeductionPayments {
  id                  String             @id @default(uuid())
  amount              Decimal            @db.Decimal(12, 2)
  createdAt           DateTime           @default(now())
  deductionId         String
  paymentDate         DateTime
  processedBy         String?
  employee_deductions EmployeeDeductions @relation(fields: [deductionId], references: [id], onDelete: Cascade)
  employees           Employees?         @relation(fields: [processedBy], references: [id])

  @@map("employee_deduction_payments")
}

model EmployeeDeductions {
  id                                                  String                      @id @default(uuid())
  amount                                              Decimal                     @db.Decimal(12, 2)
  approvedAt                                          DateTime?
  approvedBy                                          String?
  createdAt                                           DateTime                    @default(now())
  employeeId                                          String
  reason                                              String?
  type                                                String
  employee_deduction_payments                         EmployeeDeductionPayments[]
  employees_employee_deductions_approvedByToemployees Employees?                  @relation("employee_deductions_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_deductions_employeeIdToemployees Employees                   @relation("employee_deductions_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_deductions")
}

model EmployeeLeaveBalance {
  id              String    @id @default(uuid())
  year            Int
  annualLeaveDays Int       @default(0)
  createdAt       DateTime  @default(now())
  employeeId      String
  remainingAnnual Int       @default(0)
  remainingSick   Int       @default(0)
  sickLeaveDays   Int       @default(0)
  updatedAt       DateTime
  usedAnnualDays  Int       @default(0)
  usedSickDays    Int       @default(0)
  employees       Employees @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, year])
  @@map("employee_leave_balance")
}

model EmployeeLeaveRequests {
  id                                                      String     @id @default(uuid())
  reason                                                  String?
  status                                                  String     @default("pending")
  approvedAt                                              DateTime?
  approvedBy                                              String?
  createdAt                                               DateTime   @default(now())
  daysRequested                                           Int
  employeeId                                              String
  endDate                                                 DateTime
  leaveType                                               String
  rejectionReason                                         String?
  startDate                                               DateTime
  updatedAt                                               DateTime
  employees_employee_leave_requests_approvedByToemployees Employees? @relation("employee_leave_requests_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_leave_requests_employeeIdToemployees Employees  @relation("employee_leave_requests_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_leave_requests")
}

model EmployeeLoanPayments {
  id             String        @id @default(uuid())
  amount         Decimal       @db.Decimal(12, 2)
  createdAt      DateTime      @default(now())
  loanId         String
  paymentDate    DateTime
  processedBy    String?
  employee_loans EmployeeLoans @relation(fields: [loanId], references: [id], onDelete: Cascade)
  employees      Employees?    @relation(fields: [processedBy], references: [id])

  @@map("employee_loan_payments")
}

model EmployeeLoans {
  id                                             String                 @id @default(uuid())
  status                                         String                 @default("active")
  approvedAt                                     DateTime?
  approvedBy                                     String?
  createdAt                                      DateTime               @default(now())
  employeeId                                     String
  loanAmount                                     Decimal                @db.Decimal(12, 2)
  monthlyDeduction                               Decimal                @db.Decimal(12, 2)
  remainingBalance                               Decimal                @db.Decimal(12, 2)
  remainingMonths                                Int
  totalMonths                                    Int
  updatedAt                                      DateTime
  employee_loan_payments                         EmployeeLoanPayments[]
  employees_employee_loans_approvedByToemployees Employees?             @relation("employee_loans_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_loans_employeeIdToemployees Employees              @relation("employee_loans_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_loans")
}

model EmployeeSalaryIncreases {
  id                                                        String     @id @default(uuid())
  reason                                                    String?
  approvedAt                                                DateTime?
  approvedBy                                                String?
  createdAt                                                 DateTime   @default(now())
  effectiveDate                                             DateTime
  employeeId                                                String
  increaseAmount                                            Decimal    @db.Decimal(12, 2)
  increasePercent                                           Decimal    @db.Decimal(5, 2)
  newSalary                                                 Decimal    @db.Decimal(12, 2)
  previousSalary                                            Decimal    @db.Decimal(12, 2)
  employees_employee_salary_increases_approvedByToemployees Employees? @relation("employee_salary_increases_approvedByToemployees", fields: [approvedBy], references: [id])
  employees_employee_salary_increases_employeeIdToemployees Employees  @relation("employee_salary_increases_employeeIdToemployees", fields: [employeeId], references: [id], onDelete: Cascade)

  @@map("employee_salary_increases")
}

model EmployeeTimeTracking {
  id            String    @id @default(uuid())
  employeeId    String
  year          Int
  month         Int
  workDays      Int       @default(0)
  totalHours    Decimal?  @db.Decimal(5, 2)
  overtimeHours Decimal?  @db.Decimal(5, 2)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime
  employees     Employees @relation(fields: [employeeId], references: [id], onDelete: Cascade)

  @@unique([employeeId, year, month])
  @@map("employee_time_tracking")
}

model Employees {
  id                                                                        String                        @id @default(uuid())
  email                                                                     String?                       @unique
  phone                                                                     String
  address                                                                   String?
  employmentStatus                                                          String                        @default("active")
  notes                                                                     String?
  compensationTypeId                                                        String
  createdAt                                                                 DateTime                      @default(now())
  createdBy                                                                 String?
  customResponsibilities                                                    String?
  dateOfBirth                                                               DateTime?
  employeeNumber                                                            String                        @unique
  firstName                                                                 String
  fullName                                                                  String
  hireDate                                                                  DateTime
  idFormatTemplateId                                                        String?
  isActive                                                                  Boolean                       @default(true)
  jobTitleId                                                                String
  lastName                                                                  String
  nationalId                                                                String                        @unique
  primaryBusinessId                                                         String
  profilePhotoUrl                                                           String?
  startDate                                                                 DateTime?
  supervisorId                                                              String?
  terminationDate                                                           DateTime?
  updatedAt                                                                 DateTime                      @default(now())
  userId                                                                    String?                       @unique
  driverLicenseNumber                                                       String?
  driverLicenseTemplateId                                                   String?
  business_orders                                                           BusinessOrders[]
  business_stock_movements                                                  BusinessStockMovements[]
  contract_renewals                                                         ContractRenewals[]
  disciplinary_actions_disciplinary_actions_createdByToemployees            DisciplinaryActions[]         @relation("disciplinary_actions_createdByToemployees")
  disciplinary_actions_disciplinary_actions_employeeIdToemployees           DisciplinaryActions[]         @relation("disciplinary_actions_employeeIdToemployees")
  employee_allowances_employee_allowances_approvedByToemployees             EmployeeAllowances[]          @relation("employee_allowances_approvedByToemployees")
  employee_allowances_employee_allowances_employeeIdToemployees             EmployeeAllowances[]          @relation("employee_allowances_employeeIdToemployees")
  employee_attendance                                                       EmployeeAttendance[]
  employee_benefits                                                         EmployeeBenefits[]
  employee_bonuses_employee_bonuses_approvedByToemployees                   EmployeeBonuses[]             @relation("employee_bonuses_approvedByToemployees")
  employee_bonuses_employee_bonuses_employeeIdToemployees                   EmployeeBonuses[]             @relation("employee_bonuses_employeeIdToemployees")
  employee_business_assignments                                             EmployeeBusinessAssignments[]
  employee_contracts_employee_contracts_employeeIdToemployees               EmployeeContracts[]           @relation("employee_contracts_employeeIdToemployees")
  employee_contracts_employee_contracts_supervisorIdToemployees             EmployeeContracts[]           @relation("employee_contracts_supervisorIdToemployees")
  employee_deduction_payments                                               EmployeeDeductionPayments[]
  employee_deductions_employee_deductions_approvedByToemployees             EmployeeDeductions[]          @relation("employee_deductions_approvedByToemployees")
  employee_deductions_employee_deductions_employeeIdToemployees             EmployeeDeductions[]          @relation("employee_deductions_employeeIdToemployees")
  employee_leave_balance                                                    EmployeeLeaveBalance[]
  employee_leave_requests_employee_leave_requests_approvedByToemployees     EmployeeLeaveRequests[]       @relation("employee_leave_requests_approvedByToemployees")
  employee_leave_requests_employee_leave_requests_employeeIdToemployees     EmployeeLeaveRequests[]       @relation("employee_leave_requests_employeeIdToemployees")
  employee_loan_payments                                                    EmployeeLoanPayments[]
  employee_loans_employee_loans_approvedByToemployees                       EmployeeLoans[]               @relation("employee_loans_approvedByToemployees")
  employee_loans_employee_loans_employeeIdToemployees                       EmployeeLoans[]               @relation("employee_loans_employeeIdToemployees")
  employee_salary_increases_employee_salary_increases_approvedByToemployees EmployeeSalaryIncreases[]     @relation("employee_salary_increases_approvedByToemployees")
  employee_salary_increases_employee_salary_increases_employeeIdToemployees EmployeeSalaryIncreases[]     @relation("employee_salary_increases_employeeIdToemployees")
  employee_time_tracking                                                    EmployeeTimeTracking[]
  compensation_types                                                        CompensationTypes             @relation(fields: [compensationTypeId], references: [id])
  driver_license_templates                                                  DriverLicenseTemplates?       @relation(fields: [driverLicenseTemplateId], references: [id])
  id_format_templates                                                       IdFormatTemplates?            @relation(fields: [idFormatTemplateId], references: [id])
  job_titles                                                                JobTitles                     @relation(fields: [jobTitleId], references: [id])
  businesses                                                                Businesses                    @relation(fields: [primaryBusinessId], references: [id])
  employees                                                                 Employees?                    @relation("employeesToemployees", fields: [supervisorId], references: [id])
  other_employees                                                           Employees[]                   @relation("employeesToemployees")
  users                                                                     Users?                        @relation(fields: [userId], references: [id])
  expense_account_payments_as_payee                                         ExpenseAccountPayments[]      @relation("ExpensePaymentPayeeEmployee")
  payroll_account_payments                                                  PayrollAccountPayments[]
  payroll_entries                                                           PayrollEntries[]
  coupons_created                                                           Coupons[]                     @relation("CouponCreatedBy")
  coupon_approvals                                                          CouponUsages[]                @relation("CouponApprovedBy")
  inventory_transfers                                                       InventoryTransfers[]          @relation("TransferEmployee")
  clothing_bales_stocked                                                    ClothingBales[]               @relation("BaleStockedBy")
  meal_program_participant                                                  MealProgramParticipants?
  meal_program_transactions_sold                                            MealProgramTransactions[]     @relation("MealProgramSoldByEmployee")

  @@map("employees")
}

model ExpenseDomains {
  id                 String              @id @default(uuid())
  name               String              @unique
  emoji              String
  description        String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  expense_categories ExpenseCategories[]

  @@map("expense_domains")
}

model ExpenseCategories {
  id                       String                   @id @default(uuid())
  name                     String
  emoji                    String                   @default("ðŸ’°")
  color                    String                   @default("#3B82F6")
  createdAt                DateTime                 @default(now())
  isDefault                Boolean                  @default(false)
  domainId                 String?
  description              String?
  isUserCreated            Boolean                  @default(false)
  createdBy                String?
  requiresSubcategory      Boolean                  @default(false)
  updatedAt                DateTime                 @default(now()) @updatedAt
  expense_account_payments ExpenseAccountPayments[] @relation("ExpensePaymentCategory")
  users                    Users?                   @relation(fields: [createdBy], references: [id])
  domain                   ExpenseDomains?          @relation(fields: [domainId], references: [id])
  expense_subcategories    ExpenseSubcategories[]
  personal_expenses        PersonalExpenses[]

  @@unique([domainId, name])
  @@index([updatedAt(sort: Desc)], map: "idx_expense_categories_updated_at")
  @@map("expense_categories")
}

model ExpenseSubcategories {
  id                       String                   @id @default(uuid())
  categoryId               String
  name                     String
  emoji                    String?
  description              String?
  isDefault                Boolean                  @default(false)
  isUserCreated            Boolean                  @default(false)
  createdAt                DateTime                 @default(now())
  createdBy                String?
  expense_account_payments ExpenseAccountPayments[] @relation("ExpensePaymentSubcategory")
  category                 ExpenseCategories        @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users                    Users?                   @relation(fields: [createdBy], references: [id])
  personal_expenses        PersonalExpenses[]

  @@unique([categoryId, name])
  @@map("expense_subcategories")
}

model ExpenseAccounts {
  id                         String                     @id @default(uuid())
  accountNumber              String                     @unique
  accountName                String
  balance                    Decimal                    @default(0) @db.Decimal(12, 2)
  description                String?
  isActive                   Boolean                    @default(true)
  lowBalanceThreshold        Decimal                    @default(500) @db.Decimal(12, 2)
  createdBy                  String
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime                   @default(now()) @updatedAt
  parentAccountId            String?
  siblingNumber              Int?
  isSibling                  Boolean                    @default(false)
  canMerge                   Boolean                    @default(true)
  businessId                 String?
  accountType                String                     @default("GENERAL") // "GENERAL" or "PERSONAL"
  business                   Businesses?                @relation("BusinessExpenseAccounts", fields: [businessId], references: [id])
  deposits                   ExpenseAccountDeposits[]
  payments                   ExpenseAccountPayments[]
  creator                    Users                      @relation("ExpenseAccountCreator", fields: [createdBy], references: [id])
  portal_integrations        PortalIntegrations[]       @relation("PortalIntegrationExpenseAccount")
  r710_business_integrations R710BusinessIntegrations[] @relation("R710IntegrationExpenseAccount")
  r710_token_sales           R710TokenSales[]           @relation("R710TokenSaleToExpenseAccount")
  wifi_token_sales           WifiTokenSales[]
  meal_program_transactions  MealProgramTransactions[]
  expense_account_grants     ExpenseAccountGrants[]     @relation("ExpenseAccountGrants")

  @@index([isActive], map: "idx_expense_accounts_active")
  @@index([balance], map: "idx_expense_accounts_balance")
  @@index([createdAt(sort: Desc)], map: "idx_expense_accounts_created")
  @@index([parentAccountId], map: "idx_expense_accounts_parent")
  @@index([isSibling], map: "idx_expense_accounts_sibling")
  @@index([businessId], map: "idx_expense_accounts_business")
  @@map("expense_accounts")
}

model ExpenseAccountGrants {
  id               String          @id @default(uuid())
  expenseAccountId String
  userId           String
  grantedBy        String
  permissionLevel  String          @default("FULL") // "VIEW" = view + reports only, "FULL" = view + payments + deposits
  grantedAt        DateTime        @default(now())
  expenseAccount   ExpenseAccounts @relation("ExpenseAccountGrants", fields: [expenseAccountId], references: [id], onDelete: Cascade)
  user             Users           @relation("ExpenseAccountGrantUser", fields: [userId], references: [id], onDelete: Cascade)
  grantor          Users           @relation("ExpenseAccountGrantGrantor", fields: [grantedBy], references: [id])

  @@unique([expenseAccountId, userId])
  @@index([userId])
  @@map("expense_account_grants")
}

model ExpenseAccountDeposits {
  id                String          @id @default(uuid())
  expenseAccountId  String
  sourceType        String
  sourceBusinessId  String?
  amount            Decimal         @db.Decimal(12, 2)
  depositDate       DateTime
  autoGeneratedNote String?
  manualNote        String?
  transactionType   String?
  createdBy         String
  createdAt         DateTime        @default(now())
  creator           Users           @relation("ExpenseAccountDepositCreator", fields: [createdBy], references: [id])
  expenseAccount    ExpenseAccounts @relation(fields: [expenseAccountId], references: [id], onDelete: Cascade)
  sourceBusiness    Businesses?     @relation("ExpenseAccountDepositSource", fields: [sourceBusinessId], references: [id])

  @@index([expenseAccountId, depositDate])
  @@index([sourceBusinessId])
  @@index([expenseAccountId], map: "idx_expense_deposits_account")
  @@index([expenseAccountId, depositDate(sort: Desc)], map: "idx_expense_deposits_account_date")
  @@index([depositDate(sort: Desc)], map: "idx_expense_deposits_date")
  @@index([sourceType], map: "idx_expense_deposits_type")
  @@map("expense_account_deposits")
}

model ExpenseAccountPayments {
  id                       String                   @id @default(uuid())
  expenseAccountId         String
  payeeType                String
  payeeUserId              String?
  payeeEmployeeId          String?
  payeePersonId            String?
  payeeBusinessId          String?
  payeeSupplierId          String?
  categoryId               String
  subcategoryId            String?
  subSubcategoryId         String?
  amount                   Decimal                  @db.Decimal(12, 2)
  paymentDate              DateTime
  notes                    String?
  receiptNumber            String?
  receiptServiceProvider   String?
  receiptReason            String?
  isFullPayment            Boolean                  @default(true)
  batchId                  String?
  status                   String                   @default("SUBMITTED")
  createdBy                String
  submittedBy              String?
  submittedAt              DateTime?
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime                 @default(now()) @updatedAt
  category                 ExpenseCategories        @relation("ExpensePaymentCategory", fields: [categoryId], references: [id])
  creator                  Users                    @relation("ExpensePaymentCreator", fields: [createdBy], references: [id])
  expenseAccount           ExpenseAccounts          @relation(fields: [expenseAccountId], references: [id], onDelete: Cascade)
  payeeBusiness            Businesses?              @relation("ExpensePaymentPayeeBusiness", fields: [payeeBusinessId], references: [id])
  payeeSupplier            BusinessSuppliers?       @relation("ExpensePaymentPayeeSupplier", fields: [payeeSupplierId], references: [id])
  payeeEmployee            Employees?               @relation("ExpensePaymentPayeeEmployee", fields: [payeeEmployeeId], references: [id])
  payeePerson              Persons?                 @relation("ExpensePaymentPayeePerson", fields: [payeePersonId], references: [id])
  payeeUser                Users?                   @relation("ExpensePaymentPayeeUser", fields: [payeeUserId], references: [id])
  subcategory              ExpenseSubcategories?    @relation("ExpensePaymentSubcategory", fields: [subcategoryId], references: [id])
  submitter                Users?                   @relation("ExpensePaymentSubmitter", fields: [submittedBy], references: [id])
  meal_program_transaction MealProgramTransactions? @relation("MealProgramExpensePayment")

  @@index([expenseAccountId, paymentDate])
  @@index([categoryId])
  @@index([payeeType])
  @@index([batchId])
  @@index([status])
  @@index([expenseAccountId, paymentDate(sort: Desc)], map: "idx_expense_payments_account_date")
  @@index([expenseAccountId, status], map: "idx_expense_payments_account_status")
  @@index([createdAt(sort: Desc)], map: "idx_expense_payments_created_at")
  @@index([paymentDate(sort: Desc)], map: "idx_expense_payments_payment_date")
  @@map("expense_account_payments")
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MBM-124: Employee & Guest Discounted Meal Program
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

model MealProgramParticipants {
  id              String   @id @default(uuid())
  businessId      String
  participantType String // "EMPLOYEE" | "EXTERNAL"
  employeeId      String?  @unique
  personId        String?  @unique
  isActive        Boolean  @default(true)
  registeredBy    String
  registeredAt    DateTime @default(now())
  notes           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @default(now()) @updatedAt

  businesses   Businesses                @relation(fields: [businessId], references: [id])
  employees    Employees?                @relation(fields: [employeeId], references: [id])
  persons      Persons?                  @relation(fields: [personId], references: [id])
  registrar    Users                     @relation("MealProgramParticipantRegistrar", fields: [registeredBy], references: [id])
  transactions MealProgramTransactions[]

  @@unique([businessId, employeeId])
  @@unique([businessId, personId])
  @@index([businessId, isActive])
  @@index([employeeId])
  @@index([personId])
  @@map("meal_program_participants")
}

model MealProgramEligibleItems {
  id         String   @id @default(uuid())
  businessId String
  productId  String
  isActive   Boolean  @default(true)
  notes      String?
  createdBy  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  businesses Businesses       @relation(fields: [businessId], references: [id])
  product    BusinessProducts @relation(fields: [productId], references: [id])
  creator    Users            @relation("MealProgramEligibleItemCreator", fields: [createdBy], references: [id])

  @@unique([businessId, productId])
  @@index([businessId, isActive])
  @@map("meal_program_eligible_items")
}

model MealProgramTransactions {
  id                       String   @id @default(uuid())
  businessId               String
  participantId            String
  orderId                  String   @unique
  expenseAccountId         String
  expensePaymentId         String?  @unique
  soldByEmployeeId         String?
  soldByUserId             String
  subsidyAmount            Decimal  @default(0.50) @db.Decimal(10, 2)
  cashAmount               Decimal  @default(0) @db.Decimal(10, 2)
  totalAmount              Decimal  @db.Decimal(10, 2)
  subsidizedProductId      String?
  subsidizedProductName    String?
  subsidizedIsEligibleItem Boolean  @default(true)
  transactionDate          DateTime @default(now())
  itemsSummary             Json
  notes                    String?
  createdAt                DateTime @default(now())

  businesses     Businesses              @relation(fields: [businessId], references: [id])
  participant    MealProgramParticipants @relation(fields: [participantId], references: [id])
  order          BusinessOrders          @relation(fields: [orderId], references: [id])
  expenseAccount ExpenseAccounts         @relation(fields: [expenseAccountId], references: [id])
  expensePayment ExpenseAccountPayments? @relation("MealProgramExpensePayment", fields: [expensePaymentId], references: [id])
  soldByEmployee Employees?              @relation("MealProgramSoldByEmployee", fields: [soldByEmployeeId], references: [id])
  soldByUser     Users                   @relation("MealProgramSoldByUser", fields: [soldByUserId], references: [id])

  @@index([businessId, transactionDate])
  @@index([participantId, transactionDate])
  @@index([soldByEmployeeId])
  @@map("meal_program_transactions")
}

model EmojiLookup {
  id          String   @id @default(uuid())
  emoji       String
  description String
  name        String?
  url         String?
  source      String
  fetchedAt   DateTime @default(now())
  usageCount  Int      @default(0)

  @@unique([emoji, description])
  @@index([description])
  @@map("emoji_lookup")
}

model InventoryDomains {
  id                  String               @id @default(uuid())
  name                String               @unique
  emoji               String
  description         String?
  businessType        String
  isActive            Boolean              @default(true)
  isSystemTemplate    Boolean              @default(false)
  createdAt           DateTime             @default(now())
  business_categories BusinessCategories[]

  @@map("inventory_domains")
}

model InventorySubcategories {
  id                String             @id @default(uuid())
  categoryId        String
  name              String
  emoji             String?
  description       String?
  isDefault         Boolean            @default(false)
  isUserCreated     Boolean            @default(false)
  displayOrder      Int                @default(0)
  createdAt         DateTime           @default(now())
  createdBy         String?
  business_products BusinessProducts[]
  category          BusinessCategories @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  users             Users?             @relation("SubcategoryCreatedBy", fields: [createdBy], references: [id])

  @@unique([categoryId, name])
  @@map("inventory_subcategories")
}

model FundSources {
  id         String   @id @default(uuid())
  name       String
  emoji      String?  @default("ðŸ’°")
  createdAt  DateTime @default(now())
  isDefault  Boolean  @default(false)
  usageCount Int      @default(0)
  userId     String?
  users      Users?   @relation(fields: [userId], references: [id])

  @@map("fund_sources")
}

model IdFormatTemplates {
  id          String      @id @default(uuid())
  name        String
  description String?
  pattern     String
  example     String
  countryCode String?
  createdAt   DateTime    @default(now())
  isActive    Boolean     @default(true)
  updatedAt   DateTime    @default(now())
  format      String?
  employees   Employees[]
  persons     Persons[]

  @@map("id_format_templates")
}

model FullSyncSessions {
  id                     String    @id(map: "initial_load_sessions_pkey") @default(uuid())
  sessionId              String    @unique(map: "initial_load_sessions_sessionId_key")
  sourceNodeId           String
  targetNodeId           String
  tableName              String    @default("businesses")
  totalRecords           Int       @default(0)
  processedRecords       Int       @default(0)
  status                 String    @default("PENDING")
  startedAt              DateTime  @default(now())
  completedAt            DateTime?
  errorMessage           String?
  batchSize              Int       @default(1000)
  currentBatch           Int       @default(0)
  metadata               Json?
  createdAt              DateTime  @default(now())
  transferredRecords     Int       @default(0)
  transferredBytes       BigInt    @default(0)
  progress               Int       @default(0)
  currentStep            String?
  estimatedTimeRemaining Int       @default(0)
  direction              String    @default("push")
  method                 String    @default("backup")
  phase                  String?
  transferSpeed          Float?
  estimatedCompletion    DateTime?

  @@map("full_sync_sessions")
}

model InterBusinessLoans {
  id                                                             String             @id @default(uuid())
  loanNumber                                                     String             @unique
  principalAmount                                                Decimal            @db.Decimal(12, 2)
  interestRate                                                   Decimal            @default(0) @db.Decimal(5, 2)
  totalAmount                                                    Decimal            @db.Decimal(12, 2)
  remainingBalance                                               Decimal            @db.Decimal(12, 2)
  lenderType                                                     String
  lenderUserId                                                   String?
  lenderBusinessId                                               String?
  borrowerBusinessId                                             String?
  loanDate                                                       DateTime
  dueDate                                                        DateTime?
  status                                                         String             @default("active")
  terms                                                          String?
  notes                                                          String?
  createdAt                                                      DateTime           @default(now())
  updatedAt                                                      DateTime
  createdBy                                                      String
  borrowerPersonId                                               String?
  borrowerType                                                   String
  lenderPersonId                                                 String?            @map("lender_person_id")
  businesses_inter_business_loans_borrowerBusinessIdTobusinesses Businesses?        @relation("inter_business_loans_borrowerBusinessIdTobusinesses", fields: [borrowerBusinessId], references: [id])
  persons_borrower                                               Persons?           @relation("loans_as_borrower", fields: [borrowerPersonId], references: [id])
  users_inter_business_loans_createdByTousers                    Users              @relation("inter_business_loans_createdByTousers", fields: [createdBy], references: [id])
  businesses_inter_business_loans_lenderBusinessIdTobusinesses   Businesses?        @relation("inter_business_loans_lenderBusinessIdTobusinesses", fields: [lenderBusinessId], references: [id])
  users_inter_business_loans_lenderUserIdTousers                 Users?             @relation("inter_business_loans_lenderUserIdTousers", fields: [lenderUserId], references: [id])
  persons_lender                                                 Persons?           @relation("loans_as_lender", fields: [lenderPersonId], references: [id])
  loan_transactions                                              LoanTransactions[]

  @@map("inter_business_loans")
}

model JobTitles {
  id                 String              @id @default(uuid())
  title              String              @unique
  description        String?
  responsibilities   String[]
  department         String?
  level              String?
  isActive           Boolean             @default(true)
  createdAt          DateTime            @default(now())
  updatedAt          DateTime            @default(now())
  employee_contracts EmployeeContracts[]
  employees          Employees[]

  // Role template fields
  jobSummary              String?
  skillsRequired          String[]
  qualifications          String[]
  businessType            String?
  isRoleTemplate          Boolean  @default(false)
  defaultNotes            String?
  defaultPermissionPreset String?

  @@map("job_titles")
}

model LoanTransactions {
  id                    String             @id @default(uuid())
  loanId                String
  transactionType       String
  amount                Decimal            @db.Decimal(12, 2)
  description           String?
  transactionDate       DateTime
  personalExpenseId     String?
  businessTransactionId String?
  isAutoGenerated       Boolean            @default(false)
  autoGeneratedNote     String?
  initiatedFrom         String?
  balanceAfter          Decimal            @db.Decimal(12, 2)
  createdAt             DateTime           @default(now())
  createdBy             String
  users                 Users              @relation(fields: [createdBy], references: [id])
  inter_business_loans  InterBusinessLoans @relation(fields: [loanId], references: [id], onDelete: Cascade)
  personal_expenses     PersonalExpenses?  @relation(fields: [personalExpenseId], references: [id])

  @@map("loan_transactions")
}

model MenuComboItems {
  id                 String            @id @default(uuid())
  comboId            String
  productId          String?
  variantId          String?
  tokenConfigId      String?
  quantity           Int               @default(1)
  isRequired         Boolean           @default(true)
  sortOrder          Int               @default(0)
  createdAt          DateTime          @default(now())
  menu_combos        MenuCombos        @relation(fields: [comboId], references: [id], onDelete: Cascade)
  business_products  BusinessProducts? @relation(fields: [productId], references: [id], onDelete: Cascade)
  product_variants   ProductVariants?  @relation(fields: [variantId], references: [id])
  r710_token_configs R710TokenConfigs? @relation(fields: [tokenConfigId], references: [id], onDelete: Cascade)

  @@index([tokenConfigId])
  @@map("menu_combo_items")
}

model MenuCombos {
  id                 String           @id @default(uuid())
  businessId         String
  name               String
  description        String?
  totalPrice         Decimal          @db.Decimal(10, 2)
  originalTotalPrice Decimal?         @db.Decimal(10, 2)
  isActive           Boolean          @default(true)
  isAvailable        Boolean          @default(true)
  imageUrl           String?
  preparationTime    Int              @default(0)
  discountPercent    Decimal?         @db.Decimal(5, 2)
  promotionStartDate DateTime?
  promotionEndDate   DateTime?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now()) @updatedAt
  menu_combo_items   MenuComboItems[]
  businesses         Businesses       @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@map("menu_combos")
}

model MenuItems {
  id          String       @id @default(uuid())
  name        String
  description String?
  price       Decimal      @db.Decimal(10, 2)
  category    String
  barcode     String?
  createdAt   DateTime     @default(now())
  isAvailable Boolean      @default(true)
  updatedAt   DateTime     @default(now())
  order_items OrderItems[]

  @@map("menu_items")
}

model MenuPromotions {
  id                   String        @id @default(uuid())
  businessId           String
  name                 String
  description          String?
  type                 PromotionType
  value                Decimal       @db.Decimal(10, 2)
  minOrderAmount       Decimal?      @db.Decimal(10, 2)
  maxDiscountAmount    Decimal?      @db.Decimal(10, 2)
  startDate            DateTime
  endDate              DateTime?
  startTime            String?
  endTime              String?
  daysOfWeek           String[]
  isActive             Boolean       @default(true)
  usageLimit           Int?
  usageCount           Int           @default(0)
  applicableCategories String[]
  applicableProducts   String[]
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  businesses           Businesses    @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@map("menu_promotions")
}

model NetworkPartitions {
  id                 String    @id @default(uuid())
  nodeId             String
  partitionType      String
  startTime          DateTime
  detectedAt         DateTime
  isResolved         Boolean   @default(false)
  endTime            DateTime?
  partitionMetadata  Json?
  resolutionMetadata Json?
  createdAt          DateTime  @default(now())

  @@map("network_partitions")
}

model NodeStates {
  id          String   @id @default(uuid())
  nodeId      String   @unique
  nodeName    String
  lastSeen    DateTime @default(now())
  isOnline    Boolean  @default(false)
  syncVersion String
  metadata    Json?
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@map("node_states")
}

model OfflineQueue {
  id           String    @id @default(uuid())
  nodeId       String
  eventId      String
  tableName    String
  recordId     String
  operation    String
  changeData   Json
  beforeData   Json?
  queuedAt     DateTime  @default(now())
  priority     Int       @default(5)
  retryCount   Int       @default(0)
  lastAttempt  DateTime?
  errorMessage String?
  dependencies Json?
  isProcessed  Boolean   @default(false)

  @@map("offline_queue")
}

model OrderItems {
  id         String     @id @default(uuid())
  quantity   Int
  price      Decimal    @db.Decimal(10, 2)
  notes      String?
  menuItemId String?
  orderId    String?
  menu_items MenuItems? @relation(fields: [menuItemId], references: [id])
  orders     Orders?    @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_items")
}

model Orders {
  id          String       @id @default(uuid())
  total       Decimal      @db.Decimal(10, 2)
  status      String       @default("pending")
  createdAt   DateTime     @default(now())
  createdBy   String?
  orderNumber String       @unique
  tableNumber String?
  order_items OrderItems[]
  users       Users?       @relation(fields: [createdBy], references: [id])

  @@map("orders")
}

model PayrollAdjustments {
  id                                          String          @id @default(uuid())
  payrollEntryId                              String?
  amount                                      Decimal         @db.Decimal(12, 2)
  reason                                      String?
  createdAt                                   DateTime        @default(now())
  createdBy                                   String?
  adjustmentType                              String?
  approvedAt                                  DateTime?
  approvedBy                                  String?
  status                                      String          @default("pending")
  updatedAt                                   DateTime        @default(now())
  users_payroll_adjustments_approvedByTousers Users?          @relation("payroll_adjustments_approvedByTousers", fields: [approvedBy], references: [id])
  users_payroll_adjustments_createdByTousers  Users?          @relation("payroll_adjustments_createdByTousers", fields: [createdBy], references: [id])
  payroll_entries                             PayrollEntries? @relation(fields: [payrollEntryId], references: [id], onDelete: Cascade)

  @@index([payrollEntryId])
  @@map("payroll_adjustments")
}

model PayrollEntries {
  id                      String                 @id @default(uuid())
  payrollPeriodId         String?
  employeeId              String?
  employeeNumber          String?
  employeeName            String?
  nationalId              String?
  overtimeHours           Decimal                @default(0) @db.Decimal(10, 2)
  baseSalary              Decimal                @default(0) @db.Decimal(12, 2)
  commission              Decimal                @default(0) @db.Decimal(12, 2)
  livingAllowance         Decimal                @default(0) @db.Decimal(12, 2)
  vehicleAllowance        Decimal                @default(0) @db.Decimal(12, 2)
  travelAllowance         Decimal                @default(0) @db.Decimal(12, 2)
  overtimePay             Decimal                @default(0) @db.Decimal(12, 2)
  benefitsTotal           Decimal                @default(0) @db.Decimal(12, 2)
  benefitsBreakdown       Json?
  loanDeductions          Decimal                @default(0) @db.Decimal(12, 2)
  advanceDeductions       Decimal                @default(0) @db.Decimal(12, 2)
  advanceBreakdown        Json?
  miscDeductions          Decimal                @default(0) @db.Decimal(12, 2)
  grossPay                Decimal                @default(0) @db.Decimal(12, 2)
  totalDeductions         Decimal                @default(0) @db.Decimal(12, 2)
  netPay                  Decimal                @default(0) @db.Decimal(12, 2)
  adjustmentsTotal        Decimal                @default(0) @db.Decimal(12, 2)
  createdAt               DateTime               @default(now())
  updatedAt               DateTime               @default(now())
  notes                   String?
  absenceDays             Int                    @default(0)
  dateOfBirth             DateTime?
  hireDate                DateTime?
  leaveDays               Int                    @default(0)
  processedBy             String?
  sickDays                Int                    @default(0)
  terminationDate         DateTime?
  workDays                Int                    @default(0)
  absenceFraction         Decimal                @default(0) @db.Decimal(4, 2)
  contractEndDate         DateTime?
  contractId              String?
  contractNumber          String?
  contractStartDate       DateTime?
  isProrated              Boolean                @default(false)
  doubleTimeOvertimeHours Decimal                @default(0) @db.Decimal(10, 2)
  standardOvertimeHours   Decimal                @default(0) @db.Decimal(10, 2)
  contractSnapshot        Json?
  payroll_adjustments     PayrollAdjustments[]
  employees               Employees?             @relation(fields: [employeeId], references: [id])
  payroll_periods         PayrollPeriods?        @relation(fields: [payrollPeriodId], references: [id], onDelete: Cascade)
  users                   Users?                 @relation(fields: [processedBy], references: [id])
  payroll_entry_benefits  PayrollEntryBenefits[]

  @@index([contractId])
  @@index([employeeId])
  @@index([payrollPeriodId])
  @@map("payroll_entries")
}

model PayrollEntryBenefits {
  id                String         @id @default(uuid())
  payrollEntryId    String
  benefitTypeId     String
  benefitName       String
  amount            Decimal        @db.Decimal(12, 2)
  isActive          Boolean        @default(true)
  deactivatedReason String?
  source            String         @default("contract")
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @default(now())
  benefit_types     BenefitTypes   @relation(fields: [benefitTypeId], references: [id], onDelete: Cascade)
  payroll_entries   PayrollEntries @relation(fields: [payrollEntryId], references: [id], onDelete: Cascade)

  @@index([benefitTypeId])
  @@index([payrollEntryId])
  @@map("payroll_entry_benefits")
}

model PayrollExports {
  id              String         @id @default(uuid())
  payrollPeriodId String
  businessId      String
  year            Int
  month           Int
  fileName        String
  fileUrl         String
  fileSize        Int
  format          String         @default("excel")
  includesMonths  Int[]
  employeeCount   Int
  totalGrossPay   Decimal        @db.Decimal(12, 2)
  totalNetPay     Decimal        @db.Decimal(12, 2)
  exportedAt      DateTime?
  exportedBy      String
  generationType  String
  notes           String?
  businesses      Businesses     @relation(fields: [businessId], references: [id], map: "payroll_exports_businessid_fkey")
  users           Users          @relation(fields: [exportedBy], references: [id], map: "payroll_exports_exportedby_fkey")
  payroll_periods PayrollPeriods @relation(fields: [payrollPeriodId], references: [id], map: "payroll_exports_payrollperiodid_fkey")

  @@map("payroll_exports")
}

model PayrollPeriods {
  id                                      String           @id @default(uuid())
  businessId                              String
  year                                    Int
  month                                   Int
  periodStart                             DateTime?
  periodEnd                               DateTime?
  status                                  String           @default("draft")
  totalEmployees                          Int              @default(0)
  totalGrossPay                           Decimal          @default(0) @db.Decimal(12, 2)
  totalDeductions                         Decimal          @default(0) @db.Decimal(12, 2)
  totalNetPay                             Decimal          @default(0) @db.Decimal(12, 2)
  createdAt                               DateTime         @default(now())
  createdBy                               String?
  approvedAt                              DateTime?
  approvedBy                              String?
  exportedAt                              DateTime?
  closedAt                                DateTime?
  notes                                   String?
  updatedAt                               DateTime         @default(now())
  payroll_entries                         PayrollEntries[]
  payroll_exports                         PayrollExports[]
  users_payroll_periods_approvedByTousers Users?           @relation("payroll_periods_approvedByTousers", fields: [approvedBy], references: [id])
  businesses                              Businesses       @relation(fields: [businessId], references: [id], onDelete: Cascade)
  users_payroll_periods_createdByTousers  Users?           @relation("payroll_periods_createdByTousers", fields: [createdBy], references: [id])

  @@unique([businessId, year, month])
  @@index([businessId])
  @@index([year, month])
  @@map("payroll_periods")
}

model PayrollAccounts {
  id            String                   @id @default(uuid())
  businessId    String?                  @unique
  accountNumber String                   @unique
  balance       Decimal                  @default(0) @db.Decimal(12, 2)
  isActive      Boolean                  @default(true)
  createdAt     DateTime                 @default(now())
  updatedAt     DateTime                 @default(now())
  createdBy     String
  deposits      PayrollAccountDeposits[]
  payments      PayrollAccountPayments[]
  businesses    Businesses?              @relation(fields: [businessId], references: [id])
  users         Users                    @relation(fields: [createdBy], references: [id])

  @@index([businessId])
  @@map("payroll_accounts")
}

model PayrollAccountDeposits {
  id                String          @id @default(uuid())
  payrollAccountId  String
  businessId        String
  amount            Decimal         @db.Decimal(12, 2)
  depositDate       DateTime        @default(now())
  transactionType   String
  autoGeneratedNote String?
  createdBy         String
  createdAt         DateTime        @default(now())
  expenseId         String?
  businesses        Businesses      @relation(fields: [businessId], references: [id])
  users             Users           @relation(fields: [createdBy], references: [id])
  payroll_accounts  PayrollAccounts @relation(fields: [payrollAccountId], references: [id])

  @@index([payrollAccountId])
  @@index([businessId])
  @@index([depositDate])
  @@map("payroll_account_deposits")
}

model PayrollAccountPayments {
  id               String          @id @default(uuid())
  payrollAccountId String
  employeeId       String
  amount           Decimal         @db.Decimal(12, 2)
  paymentDate      DateTime        @default(now())
  paymentType      String
  status           String          @default("PENDING")
  isAdvance        Boolean         @default(false)
  isLocked         Boolean         @default(false)
  createdBy        String
  createdAt        DateTime        @default(now())
  users_created    Users           @relation("payroll_account_payments_created", fields: [createdBy], references: [id])
  employees        Employees       @relation(fields: [employeeId], references: [id])
  payroll_accounts PayrollAccounts @relation(fields: [payrollAccountId], references: [id])

  @@index([payrollAccountId])
  @@index([employeeId])
  @@index([paymentDate])
  @@index([status])
  @@map("payroll_account_payments")
}

model PermissionTemplates {
  id                   String                @id @default(uuid())
  name                 String
  permissions          Json                  @default("{}")
  businessType         String
  createdAt            DateTime              @default(now())
  createdBy            String
  isActive             Boolean               @default(true)
  updatedAt            DateTime              @default(now())
  business_memberships BusinessMemberships[]
  users                Users                 @relation(fields: [createdBy], references: [id])

  @@map("permission_templates")
}

model PersonalBudgets {
  id          String   @id @default(uuid())
  amount      Decimal  @db.Decimal(12, 2)
  description String?
  type        String   @default("deposit")
  createdAt   DateTime @default(now())
  userId      String?
  users       Users?   @relation(fields: [userId], references: [id])

  @@map("personal_budgets")
}

model PersonalExpenses {
  id                   String                @id @default(uuid())
  category             String
  description          String
  amount               Decimal               @db.Decimal(12, 2)
  date                 DateTime
  tags                 String?
  createdAt            DateTime              @default(now())
  receiptUrl           String?
  userId               String?
  notes                String?
  updatedAt            DateTime              @default(now())
  categoryId           String?
  subcategoryId        String?
  loan_transactions    LoanTransactions[]
  expense_category     ExpenseCategories?    @relation(fields: [categoryId], references: [id])
  expense_subcategory  ExpenseSubcategories? @relation(fields: [subcategoryId], references: [id])
  users                Users?                @relation(fields: [userId], references: [id])
  project_transactions ProjectTransactions[]

  @@map("personal_expenses")
}

model Persons {
  id                                String                   @id @default(uuid())
  email                             String?                  @unique
  phone                             String?
  address                           String?
  notes                             String?
  createdAt                         DateTime                 @default(now())
  createdBy                         String?
  fullName                          String
  idFormatTemplateId                String?
  isActive                          Boolean                  @default(true)
  nationalId                        String?                  @unique
  updatedAt                         DateTime                 @default(now())
  driverLicenseNumber               String?
  driverLicenseTemplateId           String?
  expense_account_payments_as_payee ExpenseAccountPayments[] @relation("ExpensePaymentPayeePerson")
  loans_as_borrower                 InterBusinessLoans[]     @relation("loans_as_borrower")
  loans_as_lender                   InterBusinessLoans[]     @relation("loans_as_lender")
  users                             Users?                   @relation(fields: [createdBy], references: [id])
  driver_license_templates          DriverLicenseTemplates?  @relation(fields: [driverLicenseTemplateId], references: [id])
  id_format_templates               IdFormatTemplates?       @relation(fields: [idFormatTemplateId], references: [id])
  project_contractors               ProjectContractors[]
  project_transactions              ProjectTransactions[]
  meal_program_participant          MealProgramParticipants?

  @@map("persons")
}

model ProductAttributes {
  id                String            @id @default(uuid())
  productId         String
  key               String
  value             String
  dataType          AttributeDataType @default(TEXT)
  displayOrder      Int               @default(0)
  createdAt         DateTime          @default(now())
  business_products BusinessProducts  @relation(fields: [productId], references: [id])

  @@unique([productId, key])
  @@map("product_attributes")
}

model ProductImages {
  id                String           @id @default(uuid())
  productId         String
  imageUrl          String
  altText           String?
  isPrimary         Boolean          @default(false)
  sortOrder         Int              @default(0)
  imageSize         ImageSize        @default(MEDIUM)
  businessType      String
  attributes        Json?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  business_products BusinessProducts @relation(fields: [productId], references: [id])

  @@map("product_images")
}

model ProductVariants {
  id                       String                   @id @default(uuid())
  productId                String
  name                     String?
  sku                      String                   @unique
  barcode                  String?
  price                    Decimal?                 @db.Decimal(10, 2)
  stockQuantity            Int                      @default(0)
  reorderLevel             Int                      @default(0)
  isActive                 Boolean                  @default(true)
  attributes               Json?
  isAvailable              Boolean                  @default(true)
  originalPrice            Decimal?                 @db.Decimal(10, 2)
  discountPercent          Decimal?                 @db.Decimal(5, 2)
  discountAmount           Decimal?                 @db.Decimal(10, 2)
  createdAt                DateTime                 @default(now())
  updatedAt                DateTime
  business_order_items     BusinessOrderItems[]
  business_stock_movements BusinessStockMovements[]
  menu_combo_items         MenuComboItems[]
  product_barcodes         ProductBarcodes[]
  business_products        BusinessProducts         @relation(fields: [productId], references: [id])
  inventory_transfer_items InventoryTransferItems[]

  @@map("product_variants")
}

model ProductBarcodes {
  id               String            @id @default(uuid())
  productId        String?
  variantId        String?
  code             String
  type             BarcodeType
  isPrimary        Boolean           @default(false)
  isUniversal      Boolean           @default(false)
  isActive         Boolean           @default(true)
  label            String?
  notes            String?
  businessId       String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  business         Businesses?       @relation(fields: [businessId], references: [id], onDelete: Cascade)
  business_product BusinessProducts? @relation(fields: [productId], references: [id], onDelete: Cascade)
  product_variant  ProductVariants?  @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@map("product_barcodes")
}

model ProjectContractors {
  id                           String                       @id @default(uuid())
  role                         String?
  status                       String                       @default("active")
  notes                        String?
  createdAt                    DateTime                     @default(now())
  endDate                      DateTime?
  hourlyRate                   Decimal?                     @db.Decimal(12, 2)
  isPrimary                    Boolean                      @default(false)
  personId                     String
  projectId                    String
  startDate                    DateTime?
  totalContractAmount          Decimal?                     @db.Decimal(12, 2)
  updatedAt                    DateTime                     @default(now())
  constructionProjectId        String?
  construction_projects        ConstructionProjects?        @relation(fields: [constructionProjectId], references: [id], onDelete: Cascade)
  persons                      Persons                      @relation(fields: [personId], references: [id], onDelete: Cascade)
  projects                     Projects                     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  project_transactions         ProjectTransactions[]
  stage_contractor_assignments StageContractorAssignments[]

  @@unique([projectId, personId])
  @@map("project_contractors")
}

model ProjectStages {
  id                           String                       @id @default(uuid())
  name                         String
  description                  String?
  status                       String                       @default("pending")
  notes                        String?
  completionDate               DateTime?
  createdAt                    DateTime                     @default(now())
  endDate                      DateTime?
  estimatedAmount              Decimal?                     @db.Decimal(12, 2)
  orderIndex                   Int                          @default(0)
  projectId                    String
  startDate                    DateTime?
  updatedAt                    DateTime                     @default(now())
  constructionProjectId        String?
  construction_projects        ConstructionProjects?        @relation(fields: [constructionProjectId], references: [id], onDelete: Cascade)
  projects                     Projects                     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  project_transactions         ProjectTransactions[]
  stage_contractor_assignments StageContractorAssignments[]

  @@map("project_stages")
}

model ProjectTransactions {
  id                                           String                      @id @default(uuid())
  amount                                       Decimal                     @db.Decimal(12, 2)
  description                                  String
  status                                       String                      @default("pending")
  notes                                        String?
  approvedAt                                   DateTime?
  approvedBy                                   String?
  createdAt                                    DateTime                    @default(now())
  createdBy                                    String?
  paidAt                                       DateTime?
  paymentCategory                              String?
  paymentMethod                                String?
  personalExpenseId                            String
  projectContractorId                          String?
  projectId                                    String
  receiptUrl                                   String?
  recipientPersonId                            String?
  referenceNumber                              String?
  stageAssignmentId                            String?
  stageId                                      String?
  transactionType                              String
  updatedAt                                    DateTime                    @default(now())
  constructionProjectId                        String?
  transactionSubType                           String?
  users_project_transactions_approvedByTousers Users?                      @relation("project_transactions_approvedByTousers", fields: [approvedBy], references: [id])
  construction_projects                        ConstructionProjects?       @relation(fields: [constructionProjectId], references: [id], onDelete: Cascade)
  users_project_transactions_createdByTousers  Users?                      @relation("project_transactions_createdByTousers", fields: [createdBy], references: [id])
  personal_expenses                            PersonalExpenses            @relation(fields: [personalExpenseId], references: [id], onDelete: Cascade)
  project_contractors                          ProjectContractors?         @relation(fields: [projectContractorId], references: [id])
  projects                                     Projects                    @relation(fields: [projectId], references: [id], onDelete: Cascade)
  persons                                      Persons?                    @relation(fields: [recipientPersonId], references: [id])
  stage_contractor_assignments                 StageContractorAssignments? @relation(fields: [stageAssignmentId], references: [id])
  project_stages                               ProjectStages?              @relation(fields: [stageId], references: [id])

  @@index([transactionSubType])
  @@map("project_transactions")
}

model ProjectTypes {
  id                    String                 @id @default(uuid())
  name                  String                 @unique
  description           String?
  businessType          String
  isActive              Boolean                @default(true)
  isSystem              Boolean                @default(false)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @default(now())
  construction_projects ConstructionProjects[]
  projects              Projects[]

  @@index([businessType])
  @@index([isActive])
  @@map("project_types")
}

model Projects {
  id                   String                @id @default(uuid())
  name                 String
  description          String?
  projectTypeId        String
  businessType         String
  businessId           String?
  status               String                @default("active")
  budget               Decimal?              @db.Decimal(12, 2)
  startDate            DateTime?
  endDate              DateTime?
  createdAt            DateTime              @default(now())
  createdBy            String?
  updatedAt            DateTime              @default(now())
  project_contractors  ProjectContractors[]
  project_stages       ProjectStages[]
  project_transactions ProjectTransactions[]
  businesses           Businesses?           @relation(fields: [businessId], references: [id])
  users                Users?                @relation(fields: [createdBy], references: [id])
  project_types        ProjectTypes          @relation(fields: [projectTypeId], references: [id])

  @@index([businessType])
  @@index([createdBy])
  @@index([status])
  @@map("projects")
}

model Sessions {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        Users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("sessions")
}

model StageContractorAssignments {
  id                   String                @id @default(uuid())
  notes                String?
  createdAt            DateTime              @default(now())
  depositAmount        Decimal?              @db.Decimal(12, 2)
  depositPaidDate      DateTime?
  depositPercentage    Decimal               @default(0.00) @db.Decimal(5, 2)
  finalPaymentDate     DateTime?
  isDepositPaid        Boolean               @default(false)
  isFinalPaymentMade   Boolean               @default(false)
  predeterminedAmount  Decimal               @db.Decimal(12, 2)
  projectContractorId  String
  stageId              String
  updatedAt            DateTime              @default(now())
  project_transactions ProjectTransactions[]
  project_contractors  ProjectContractors    @relation(fields: [projectContractorId], references: [id], onDelete: Cascade)
  project_stages       ProjectStages         @relation(fields: [stageId], references: [id], onDelete: Cascade)

  @@unique([stageId, projectContractorId])
  @@map("stage_contractor_assignments")
}

model SupplierProducts {
  id                 String            @id @default(uuid())
  supplierId         String
  productId          String
  supplierSku        String?
  supplierPrice      Decimal           @db.Decimal(10, 2)
  minimumOrder       Int               @default(1)
  leadTimeDays       Int               @default(0)
  isActive           Boolean           @default(true)
  attributes         Json?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime
  business_products  BusinessProducts  @relation(fields: [productId], references: [id])
  business_suppliers BusinessSuppliers @relation(fields: [supplierId], references: [id])

  @@unique([supplierId, productId])
  @@map("supplier_products")
}

model SyncConfigurations {
  id                  String    @id @default(uuid())
  nodeId              String    @unique
  registrationKeyHash String?
  lastConfigUpdate    DateTime?
  configMetadata      Json?
  createdAt           DateTime  @default(now())

  @@map("sync_configurations")
}

model SyncEvents {
  eventId         String        @id @default(uuid())
  sourceNodeId    String
  tableName       String
  recordId        String
  operation       SyncOperation
  changeData      Json
  beforeData      Json?
  vectorClock     Json?
  lamportClock    String?
  checksum        String?
  priority        Int           @default(5)
  metadata        Json?
  processed       Boolean       @default(false)
  processedAt     DateTime?
  processingError String?
  retryCount      Int           @default(0)
  createdAt       DateTime      @default(now())

  @@map("sync_events")
}

model SyncMetrics {
  id                   String   @id @default(uuid())
  nodeId               String
  metricDate           DateTime
  eventsGenerated      Int      @default(0)
  eventsReceived       Int      @default(0)
  eventsProcessed      Int      @default(0)
  eventsFailed         Int      @default(0)
  conflictsDetected    Int      @default(0)
  conflictsResolved    Int      @default(0)
  syncLatencyMs        Int?
  networkLatencyMs     Int?
  dataTransferredBytes BigInt?
  peersConnected       Int?     @default(0)
  peersDiscovered      Int?     @default(0)
  createdAt            DateTime @default(now())

  @@unique([nodeId, metricDate], map: "nodeId_metricDate")
  @@map("sync_metrics")
}

model SyncNodes {
  id               String            @id @default(uuid())
  nodeId           String            @unique
  nodeName         String
  ipAddress        String?
  port             Int?
  registrationKey  String?
  publicKey        String?
  isActive         Boolean           @default(true)
  lastSeen         DateTime          @default(now())
  nodeVersion      String?
  databaseVersion  String?
  schemaVersion    String?
  schemaHash       String?
  migrationName    String?
  schemaAppliedAt  DateTime?
  schemaCompatible Boolean           @default(true)
  platformInfo     Json?
  capabilities     Json?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  network_printers NetworkPrinters[]

  @@map("sync_nodes")
}

model SyncSessions {
  id           String    @id @default(uuid())
  sessionId    String    @unique
  sourceNodeId String
  targetNodeId String?
  startedAt    DateTime  @default(now())
  endedAt      DateTime?
  endTime      DateTime?
  status       String    @default("PENDING")
  errorMessage String?
  metadata     Json?
  createdAt    DateTime  @default(now())

  @@map("sync_sessions")
}

model NetworkPrinters {
  id                 String             @id @default(uuid())
  printerId          String             @unique
  printerName        String
  printerType        String
  nodeId             String
  ipAddress          String?
  port               Int?
  capabilities       Json?
  isShareable        Boolean            @default(false)
  isOnline           Boolean            @default(true)
  lastSeen           DateTime           @default(now())
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @default(now()) @updatedAt
  receiptWidth       Int?               @default(48)
  barcode_print_jobs BarcodePrintJobs[]
  sync_nodes         SyncNodes          @relation(fields: [nodeId], references: [nodeId])
  print_jobs         PrintJobs[]

  @@index([nodeId])
  @@index([printerType])
  @@map("network_printers")
}

model PrintJobs {
  id               String          @id @default(uuid())
  printerId        String
  businessId       String
  businessType     String
  userId           String
  jobType          String
  jobData          Json
  status           String          @default("PENDING")
  retryCount       Int             @default(0)
  errorMessage     String?
  createdAt        DateTime        @default(now())
  processedAt      DateTime?
  updatedAt        DateTime        @default(now())
  businesses       Businesses      @relation(fields: [businessId], references: [id], onDelete: Cascade)
  network_printers NetworkPrinters @relation(fields: [printerId], references: [id], onDelete: Cascade)
  users            Users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([printerId])
  @@index([businessId])
  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@map("print_jobs")
}

model Users {
  id                                                              String                      @id @default(uuid())
  email                                                           String                      @unique
  passwordHash                                                    String
  name                                                            String
  role                                                            String                      @default("user")
  permissions                                                     Json                        @default("{}")
  isActive                                                        Boolean                     @default(true)
  passwordResetRequired                                           Boolean                     @default(false)
  deactivatedAt                                                   DateTime?
  deactivatedBy                                                   String?
  deactivationReason                                              String?
  deactivationNotes                                               String?
  reactivatedAt                                                   DateTime?
  reactivatedBy                                                   String?
  reactivationNotes                                               String?
  createdAt                                                       DateTime                    @default(now())
  updatedAt                                                       DateTime                    @default(now())
  lastAccessedAt                                                  DateTime?
  lastAccessedBusinessId                                          String?
  lastAccessedBusinessType                                        String?
  username                                                        String?                     @unique
  accounts                                                        Accounts[]
  audit_logs                                                      AuditLogs[]
  barcode_inventory_items                                         BarcodeInventoryItems[]
  barcode_print_jobs                                              BarcodePrintJobs[]
  barcode_templates                                               BarcodeTemplates[]
  business_accounts                                               BusinessAccounts[]
  inventory_categories                                            BusinessCategories[]        @relation("CategoryCreatedBy")
  business_memberships                                            BusinessMemberships[]
  business_transactions                                           BusinessTransactions[]
  chat_messages                                                   ChatMessages[]
  chat_participants                                               ChatParticipants[]
  chat_rooms                                                      ChatRooms[]
  construction_expenses                                           ConstructionExpenses[]
  construction_projects                                           ConstructionProjects[]
  customer_layby_payment_processors                               CustomerLaybyPayment[]      @relation("CustomerLaybyPaymentProcessor")
  customer_layby_creators                                         CustomerLayby[]             @relation("CustomerLaybyCreator")
  driver_authorizations                                           DriverAuthorizations[]
  employees                                                       Employees?
  expense_account_deposits_created                                ExpenseAccountDeposits[]    @relation("ExpenseAccountDepositCreator")
  expense_account_payments_created                                ExpenseAccountPayments[]    @relation("ExpensePaymentCreator")
  expense_account_payments_as_payee                               ExpenseAccountPayments[]    @relation("ExpensePaymentPayeeUser")
  expense_account_payments_submitted                              ExpenseAccountPayments[]    @relation("ExpensePaymentSubmitter")
  expense_accounts_created                                        ExpenseAccounts[]           @relation("ExpenseAccountCreator")
  expense_account_grants_received                                 ExpenseAccountGrants[]      @relation("ExpenseAccountGrantUser")
  expense_account_grants_given                                    ExpenseAccountGrants[]      @relation("ExpenseAccountGrantGrantor")
  expense_categories                                              ExpenseCategories[]
  expense_subcategories                                           ExpenseSubcategories[]
  fund_sources                                                    FundSources[]
  inter_business_loans_inter_business_loans_createdByTousers      InterBusinessLoans[]        @relation("inter_business_loans_createdByTousers")
  inter_business_loans_inter_business_loans_lenderUserIdTousers   InterBusinessLoans[]        @relation("inter_business_loans_lenderUserIdTousers")
  inventory_subcategories                                         InventorySubcategories[]    @relation("SubcategoryCreatedBy")
  loan_transactions                                               LoanTransactions[]
  mac_acl_entries_approved                                        MacAclEntry[]               @relation("MacAclApprover")
  mac_acl_entries_created                                         MacAclEntry[]               @relation("MacAclCreator")
  orders                                                          Orders[]
  payroll_account_deposits                                        PayrollAccountDeposits[]
  payroll_account_payments_created                                PayrollAccountPayments[]    @relation("payroll_account_payments_created")
  payroll_accounts                                                PayrollAccounts[]
  payroll_adjustments_payroll_adjustments_approvedByTousers       PayrollAdjustments[]        @relation("payroll_adjustments_approvedByTousers")
  payroll_adjustments_payroll_adjustments_createdByTousers        PayrollAdjustments[]        @relation("payroll_adjustments_createdByTousers")
  payroll_entries                                                 PayrollEntries[]
  payroll_exports                                                 PayrollExports[]
  payroll_periods_payroll_periods_approvedByTousers               PayrollPeriods[]            @relation("payroll_periods_approvedByTousers")
  payroll_periods_payroll_periods_createdByTousers                PayrollPeriods[]            @relation("payroll_periods_createdByTousers")
  permission_templates                                            PermissionTemplates[]
  personal_budgets                                                PersonalBudgets[]
  personal_expenses                                               PersonalExpenses[]
  persons                                                         Persons[]
  portal_integrations_created                                     PortalIntegrations[]        @relation("PortalIntegrationCreator")
  print_jobs                                                      PrintJobs[]
  product_price_changes                                           product_price_changes[]
  project_transactions_project_transactions_approvedByTousers     ProjectTransactions[]       @relation("project_transactions_approvedByTousers")
  project_transactions_project_transactions_createdByTousers      ProjectTransactions[]       @relation("project_transactions_createdByTousers")
  projects                                                        Projects[]
  r710_device_registry                                            R710DeviceRegistry[]        @relation("R710DeviceCreator")
  r710_token_sales                                                R710TokenSales[]            @relation("R710TokenSaleSeller")
  reprint_logs                                                    ReprintLog[]
  saved_reports                                                   SavedReports[]
  seed_data_templates                                             SeedDataTemplates[]
  sessions                                                        Sessions[]
  userPermissions                                                 UserPermissions[]
  vehicle_drivers                                                 VehicleDrivers[]
  vehicle_expenses                                                VehicleExpenses[]
  vehicle_maintenance_records                                     VehicleMaintenanceRecords[]
  vehicle_reimbursements_vehicle_reimbursements_approvedByTousers VehicleReimbursements[]     @relation("vehicle_reimbursements_approvedByTousers")
  vehicle_reimbursements_vehicle_reimbursements_userIdTousers     VehicleReimbursements[]     @relation("vehicle_reimbursements_userIdTousers")
  vehicles                                                        Vehicles[]
  wifi_token_sales                                                WifiTokenSales[]            @relation("WifiTokenSaleSeller")
  meal_program_participants_registered                            MealProgramParticipants[]   @relation("MealProgramParticipantRegistrar")
  meal_program_transactions_sold                                  MealProgramTransactions[]   @relation("MealProgramSoldByUser")
  meal_program_eligible_items_created                             MealProgramEligibleItems[]  @relation("MealProgramEligibleItemCreator")
  business_orders_created                                        BusinessOrders[]            @relation("BusinessOrderCreator")

  @@map("users")
}

model VehicleDrivers {
  id                       String                  @id @default(uuid())
  fullName                 String
  licenseNumber            String                  @unique
  licenseExpiry            DateTime?
  phoneNumber              String?
  emailAddress             String?
  emergencyContact         String?
  emergencyPhone           String?
  userId                   String?
  isActive                 Boolean                 @default(true)
  dateOfBirth              DateTime?
  address                  String?
  createdAt                DateTime                @default(now())
  updatedAt                DateTime
  licenseCountryOfIssuance String
  driverLicenseTemplateId  String?
  driver_authorizations    DriverAuthorizations[]
  driver_license_templates DriverLicenseTemplates? @relation(fields: [driverLicenseTemplateId], references: [id])
  users                    Users?                  @relation(fields: [userId], references: [id])
  vehicle_trips            VehicleTrips[]

  @@map("vehicle_drivers")
}

model VehicleExpenses {
  id                   String        @id @default(uuid())
  vehicleId            String
  tripId               String?
  businessId           String?
  expenseType          ExpenseType
  expenseCategory      String?
  amount               Decimal       @db.Decimal(10, 2)
  currency             String        @default("USD")
  expenseDate          DateTime
  isBusinessDeductible Boolean       @default(false)
  receiptUrl           String?
  vendorName           String?
  description          String?
  mileageAtExpense     Int?
  fuelQuantity         Decimal?      @db.Decimal(8, 2)
  fuelType             FuelType?
  createdBy            String
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  businesses           Businesses?   @relation(fields: [businessId], references: [id])
  users                Users         @relation(fields: [createdBy], references: [id])
  vehicle_trips        VehicleTrips? @relation(fields: [tripId], references: [id])
  vehicles             Vehicles      @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("vehicle_expenses")
}

model VehicleLicenses {
  id               String      @id @default(uuid())
  vehicleId        String
  licenseType      LicenseType
  licenseNumber    String
  issuingAuthority String?
  issueDate        DateTime
  expiryDate       DateTime
  renewalCost      Decimal?    @db.Decimal(10, 2)
  isActive         Boolean     @default(true)
  documentUrl      String?
  reminderDays     Int         @default(30)
  createdAt        DateTime    @default(now())
  updatedAt        DateTime
  vehicles         Vehicles    @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("vehicle_licenses")
}

model VehicleMaintenanceRecords {
  id                           String                       @id @default(uuid())
  vehicleId                    String
  serviceType                  ServiceType
  serviceCategory              String?
  serviceName                  String
  serviceDate                  DateTime
  mileageAtService             Int
  nextServiceDue               DateTime?
  nextServiceMileage           Int?
  serviceCost                  Decimal                      @db.Decimal(10, 2)
  serviceProvider              String?
  serviceLocation              String?
  partsReplaced                Json?
  warrantyInfo                 String?
  receiptUrl                   String?
  notes                        String?
  isScheduledService           Boolean                      @default(false)
  createdBy                    String
  createdAt                    DateTime                     @default(now())
  updatedAt                    DateTime
  users                        Users                        @relation(fields: [createdBy], references: [id])
  vehicles                     Vehicles                     @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vehicle_maintenance_services VehicleMaintenanceServices[]

  @@map("vehicle_maintenance_records")
}

model VehicleMaintenanceServiceExpenses {
  id                           String                     @id @default(uuid())
  serviceId                    String
  expenseType                  String
  amount                       Decimal                    @db.Decimal(10, 2)
  currency                     String                     @default("USD")
  description                  String?
  vendorName                   String?
  isBusinessDeductible         Boolean                    @default(false)
  receiptUrl                   String?
  createdAt                    DateTime                   @default(now())
  updatedAt                    DateTime
  vehicle_maintenance_services VehicleMaintenanceServices @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@map("vehicle_maintenance_service_expenses")
}

model VehicleMaintenanceServices {
  id                                   String                              @id @default(uuid())
  maintenanceRecordId                  String
  serviceName                          String
  serviceType                          String
  cost                                 Decimal                             @db.Decimal(10, 2)
  currency                             String                              @default("USD")
  serviceProvider                      String?
  description                          String?
  isScheduledService                   Boolean                             @default(false)
  warrantyUntil                        String?
  receiptUrl                           String?
  createdAt                            DateTime                            @default(now())
  updatedAt                            DateTime
  vehicle_maintenance_service_expenses VehicleMaintenanceServiceExpenses[]
  vehicle_maintenance_records          VehicleMaintenanceRecords           @relation(fields: [maintenanceRecordId], references: [id], onDelete: Cascade)

  @@map("vehicle_maintenance_services")
}

model VehicleReimbursements {
  id                                             String              @id @default(uuid())
  userId                                         String
  vehicleId                                      String
  businessId                                     String
  reimbursementPeriod                            String
  totalMileage                                   Int
  businessMileage                                Int
  personalMileage                                Int
  statutoryRate                                  Decimal             @db.Decimal(8, 4)
  totalAmount                                    Decimal             @db.Decimal(10, 2)
  status                                         ReimbursementStatus @default(PENDING)
  submissionDate                                 DateTime
  approvalDate                                   DateTime?
  paymentDate                                    DateTime?
  approvedBy                                     String?
  notes                                          String?
  createdAt                                      DateTime            @default(now())
  updatedAt                                      DateTime
  users_vehicle_reimbursements_approvedByTousers Users?              @relation("vehicle_reimbursements_approvedByTousers", fields: [approvedBy], references: [id])
  businesses                                     Businesses          @relation(fields: [businessId], references: [id])
  users_vehicle_reimbursements_userIdTousers     Users               @relation("vehicle_reimbursements_userIdTousers", fields: [userId], references: [id])
  vehicles                                       Vehicles            @relation(fields: [vehicleId], references: [id])

  @@map("vehicle_reimbursements")
}

model VehicleTrips {
  id                    String               @id @default(uuid())
  vehicleId             String
  driverId              String
  businessId            String?
  startMileage          Int
  endMileage            Int?
  tripMileage           Int                  @default(0)
  tripPurpose           String
  tripType              TripType
  startLocation         String?
  endLocation           String?
  startTime             DateTime
  endTime               DateTime?
  isCompleted           Boolean              @default(false)
  notes                 String?
  gpsTrackingData       Json?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime
  vehicle_expenses      VehicleExpenses[]
  businesses            Businesses?          @relation(fields: [businessId], references: [id])
  vehicle_drivers       VehicleDrivers       @relation(fields: [driverId], references: [id], onDelete: Cascade)
  driver_authorizations DriverAuthorizations @relation(fields: [driverId, vehicleId], references: [driverId, vehicleId])
  vehicles              Vehicles             @relation(fields: [vehicleId], references: [id], onDelete: Cascade)

  @@map("vehicle_trips")
}

model Vehicles {
  id                          String                      @id @default(uuid())
  licensePlate                String                      @unique
  vin                         String                      @unique
  make                        String
  model                       String
  year                        Int
  color                       String?
  weight                      Decimal?                    @db.Decimal(10, 2)
  driveType                   DriveType
  ownershipType               OwnershipType
  currentMileage              Int
  businessId                  String?
  userId                      String?
  isActive                    Boolean                     @default(true)
  purchaseDate                DateTime?
  purchasePrice               Decimal?                    @db.Decimal(12, 2)
  notes                       String?
  createdAt                   DateTime                    @default(now())
  updatedAt                   DateTime
  hasInitialMileage           Boolean                     @default(false)
  mileageUnit                 String                      @default("km")
  driver_authorizations       DriverAuthorizations[]
  vehicle_expenses            VehicleExpenses[]
  vehicle_licenses            VehicleLicenses[]
  vehicle_maintenance_records VehicleMaintenanceRecords[]
  vehicle_reimbursements      VehicleReimbursements[]
  vehicle_trips               VehicleTrips[]
  businesses                  Businesses?                 @relation(fields: [businessId], references: [id])
  users                       Users?                      @relation(fields: [userId], references: [id])

  @@map("vehicles")
}

model SeedDataTemplates {
  id               String      @id @default(uuid())
  name             String
  businessType     String
  version          String
  description      String?
  isActive         Boolean     @default(true)
  isSystemDefault  Boolean     @default(false)
  productCount     Int         @default(0)
  categoryCount    Int         @default(0)
  templateData     Json
  createdBy        String
  createdAt        DateTime    @default(now())
  updatedAt        DateTime    @updatedAt
  sourceBusinessId String?
  exportNotes      String?
  user             Users       @relation(fields: [createdBy], references: [id])
  sourceBusiness   Businesses? @relation(fields: [sourceBusinessId], references: [id])

  @@unique([businessType, version])
  @@index([businessType, isActive])
  @@index([isSystemDefault])
  @@map("seed_data_templates")
}

model SystemSettings {
  id                             String   @id @default(uuid())
  allowSelfRegistration          Boolean  @default(true)
  defaultRegistrationRole        String   @default("employee")
  defaultRegistrationPermissions Json
  requireAdminApproval           Boolean  @default(false)
  maxUsersPerBusiness            Int      @default(50)
  globalDateFormat               String   @default("dd/mm/yyyy")
  defaultCountryCode             String   @default("ZW")
  defaultIdFormatTemplateId      String?
  defaultMileageUnit             String   @default("km")
  maxPaymentWithoutId            Decimal  @default(50) @db.Decimal(10, 2)
  createdAt                      DateTime @default(now())
  updatedAt                      DateTime @updatedAt

  @@map("system_settings")
}

model PortalIntegrations {
  id               String           @id @default(uuid())
  businessId       String           @unique
  apiKey           String
  portalIpAddress  String
  portalPort       Int
  isActive         Boolean          @default(true)
  showTokensInPOS  Boolean          @default(false)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @default(now()) @updatedAt
  createdBy        String
  expenseAccountId String?
  businesses       Businesses       @relation(fields: [businessId], references: [id], onDelete: Cascade)
  users            Users            @relation("PortalIntegrationCreator", fields: [createdBy], references: [id])
  expense_accounts ExpenseAccounts? @relation("PortalIntegrationExpenseAccount", fields: [expenseAccountId], references: [id])

  @@map("portal_integrations")
}

model TokenConfigurations {
  id                        String                   @id @default(uuid())
  name                      String
  description               String?
  durationMinutes           Int
  bandwidthDownMb           Int
  bandwidthUpMb             Int
  basePrice                 Decimal                  @db.Decimal(12, 2)
  isActive                  Boolean                  @default(true)
  displayOrder              Int                      @default(0)
  createdAt                 DateTime                 @default(now())
  updatedAt                 DateTime                 @default(now()) @updatedAt
  ssid                      String?                  @db.VarChar(255)
  business_token_menu_items BusinessTokenMenuItems[]
  wifi_tokens               WifiTokens[]

  @@map("token_configurations")
}

model BusinessTokenMenuItems {
  id                      String              @id @default(uuid())
  businessId              String
  tokenConfigId           String
  businessPrice           Decimal             @db.Decimal(12, 2)
  isActive                Boolean             @default(true)
  displayOrder            Int                 @default(0)
  createdAt               DateTime            @default(now())
  updatedAt               DateTime            @default(now()) @updatedAt
  durationMinutesOverride Int?
  bandwidthDownMbOverride Int?
  bandwidthUpMbOverride   Int?
  businesses              Businesses          @relation(fields: [businessId], references: [id], onDelete: Cascade)
  token_configurations    TokenConfigurations @relation(fields: [tokenConfigId], references: [id], onDelete: Cascade)
  wifi_tokens             WifiTokens[]

  @@unique([businessId, tokenConfigId])
  @@index([businessId])
  @@index([tokenConfigId])
  @@map("business_token_menu_items")
}

model WifiTokens {
  id                        String                  @id @default(uuid())
  businessId                String
  tokenConfigId             String
  businessTokenMenuItemId   String?
  token                     String                  @unique
  createdAt                 DateTime                @default(now())
  firstUsedAt               DateTime?
  expiresAt                 DateTime?
  bandwidthUsedDown         Decimal                 @default(0) @db.Decimal(12, 2)
  bandwidthUsedUp           Decimal                 @default(0) @db.Decimal(12, 2)
  usageCount                Int                     @default(0)
  lastSyncedAt              DateTime?
  deviceCount               Int                     @default(0)
  deviceType                String?                 @db.VarChar(100)
  firstSeen                 DateTime?
  hostname                  String?                 @db.VarChar(255)
  lastSeen                  DateTime?
  primaryMac                String?                 @db.VarChar(17)
  status                    WifiTokenStatus         @default(ACTIVE)
  esp32_connected_clients   ESP32ConnectedClients[]
  wifi_token_devices        WifiTokenDevices[]
  wifi_token_sales          WifiTokenSales[]
  businesses                Businesses              @relation(fields: [businessId], references: [id], onDelete: Cascade)
  business_token_menu_items BusinessTokenMenuItems? @relation(fields: [businessTokenMenuItemId], references: [id])
  token_configurations      TokenConfigurations     @relation(fields: [tokenConfigId], references: [id])

  @@index([businessId])
  @@index([status])
  @@index([token])
  @@index([primaryMac])
  @@index([hostname])
  @@index([lastSeen])
  @@index([tokenConfigId], map: "idx_wifi_tokens_tokenConfigId")
  @@map("wifi_tokens")
}

model WifiTokenSales {
  id               String          @id @default(uuid())
  businessId       String
  wifiTokenId      String
  expenseAccountId String
  saleAmount       Decimal         @db.Decimal(12, 2)
  paymentMethod    String
  soldAt           DateTime        @default(now())
  soldBy           String
  receiptPrinted   Boolean         @default(false)
  saleChannel      String          @default("DIRECT")
  businesses       Businesses      @relation(fields: [businessId], references: [id], onDelete: Cascade)
  expense_accounts ExpenseAccounts @relation(fields: [expenseAccountId], references: [id])
  users            Users           @relation("WifiTokenSaleSeller", fields: [soldBy], references: [id])
  wifi_tokens      WifiTokens      @relation(fields: [wifiTokenId], references: [id])

  @@index([businessId])
  @@index([wifiTokenId])
  @@index([expenseAccountId])
  @@index([soldBy])
  @@index([saleChannel])
  @@map("wifi_token_sales")
}

model WifiTokenDevices {
  id          String     @id @default(uuid())
  wifiTokenId String
  macAddress  String     @db.VarChar(17)
  isOnline    Boolean    @default(false)
  currentIp   String?    @db.VarChar(15)
  firstSeen   DateTime
  lastSeen    DateTime
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  wifiToken   WifiTokens @relation(fields: [wifiTokenId], references: [id], onDelete: Cascade)

  @@unique([wifiTokenId, macAddress])
  @@index([wifiTokenId])
  @@index([macAddress])
  @@index([isOnline])
  @@map("wifi_token_devices")
}

model ReprintLog {
  id            String         @id @default(uuid())
  orderId       String
  businessId    String
  userId        String
  receiptNumber String
  reprintedAt   DateTime       @default(now())
  notes         String?
  business      Businesses     @relation(fields: [businessId], references: [id])
  order         BusinessOrders @relation(fields: [orderId], references: [id], onDelete: Cascade)
  user          Users          @relation(fields: [userId], references: [id])

  @@index([orderId])
  @@index([businessId, reprintedAt])
  @@index([userId])
  @@map("reprint_logs")
}

model R710DeviceRegistry {
  id                         String                     @id @default(uuid())
  ipAddress                  String                     @unique @db.VarChar(45)
  adminUsername              String                     @db.VarChar(255)
  encryptedAdminPassword     String
  firmwareVersion            String?                    @db.VarChar(50)
  model                      String                     @default("R710") @db.VarChar(50)
  description                String?
  isActive                   Boolean                    @default(true)
  lastHealthCheck            DateTime?
  connectionStatus           R710ConnectionStatus       @default(DISCONNECTED)
  lastConnectedAt            DateTime?
  lastError                  String?
  createdBy                  String
  createdAt                  DateTime                   @default(now())
  updatedAt                  DateTime                   @default(now()) @updatedAt
  r710_business_integrations R710BusinessIntegrations[]
  r710_connected_clients     R710ConnectedClients[]
  creator                    Users                      @relation("R710DeviceCreator", fields: [createdBy], references: [id])
  r710_sync_logs             R710SyncLogs[]
  r710_wlans                 R710Wlans[]

  @@index([ipAddress])
  @@index([connectionStatus])
  @@index([isActive])
  @@index([lastHealthCheck])
  @@map("r710_device_registry")
}

model R710BusinessIntegrations {
  id               String             @id @default(uuid())
  businessId       String
  deviceRegistryId String
  expenseAccountId String?            @map("expense_account_id")
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @default(now()) @updatedAt
  businesses       Businesses         @relation("R710BusinessIntegration", fields: [businessId], references: [id], onDelete: Cascade)
  device_registry  R710DeviceRegistry @relation(fields: [deviceRegistryId], references: [id])
  expense_account  ExpenseAccounts?   @relation("R710IntegrationExpenseAccount", fields: [expenseAccountId], references: [id])

  @@unique([businessId, deviceRegistryId])
  @@index([businessId])
  @@index([deviceRegistryId])
  @@index([expenseAccountId])
  @@map("r710_business_integrations")
}

model R710Wlans {
  id                     String                 @id @default(uuid())
  businessId             String
  deviceRegistryId       String
  wlanId                 String                 @db.VarChar(50)
  guestServiceId         String                 @db.VarChar(50)
  ssid                   String                 @db.VarChar(255)
  logoType               String                 @default("none") @db.VarChar(20)
  title                  String                 @default("Welcome to Guest WiFi !") @db.VarChar(255)
  validDays              Int                    @default(1)
  isActive               Boolean                @default(true)
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @default(now()) @updatedAt
  enableFriendlyKey      Boolean                @default(false)
  enableZeroIt           Boolean                @default(true)
  mac_acl_entries        MacAclEntry[]
  r710_connected_clients R710ConnectedClients[]
  r710_token_configs     R710TokenConfigs[]
  r710_tokens            R710Tokens[]
  businesses             Businesses             @relation("R710WlanToBusiness", fields: [businessId], references: [id], onDelete: Cascade)
  device_registry        R710DeviceRegistry     @relation(fields: [deviceRegistryId], references: [id], onDelete: Cascade)

  @@unique([deviceRegistryId, wlanId])
  @@index([businessId])
  @@index([deviceRegistryId])
  @@index([isActive])
  @@map("r710_wlans")
}

model R710TokenConfigs {
  id                             String                       @id @default(uuid())
  businessId                     String
  wlanId                         String
  name                           String                       @db.VarChar(255)
  description                    String?
  durationValue                  Int
  durationUnit                   String                       @db.VarChar(20)
  deviceLimit                    Int                          @default(1)
  basePrice                      Decimal                      @db.Decimal(12, 2)
  autoGenerateThreshold          Int                          @default(5)
  autoGenerateQuantity           Int                          @default(20)
  isActive                       Boolean                      @default(true)
  displayOrder                   Int                          @default(0)
  createdAt                      DateTime                     @default(now())
  updatedAt                      DateTime                     @default(now()) @updatedAt
  r710_business_token_menu_items R710BusinessTokenMenuItems[]
  businesses                     Businesses                   @relation("R710TokenConfigToBusiness", fields: [businessId], references: [id], onDelete: Cascade)
  r710_wlans                     R710Wlans                    @relation(fields: [wlanId], references: [id], onDelete: Cascade)
  r710_tokens                    R710Tokens[]
  menu_combo_items               MenuComboItems[]

  @@index([businessId])
  @@index([wlanId])
  @@index([isActive])
  @@map("r710_token_configs")
}

model R710Tokens {
  id                 String             @id @default(uuid())
  businessId         String
  wlanId             String
  tokenConfigId      String
  username           String             @db.VarChar(50)
  password           String             @db.VarChar(50)
  createdAtR710      DateTime?
  expiresAtR710      DateTime?
  validTimeSeconds   Int?
  firstUsedAt        DateTime?
  status             R710TokenStatus    @default(AVAILABLE)
  connectedMac       String?            @db.VarChar(17)
  lastSyncedAt       DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @default(now()) @updatedAt
  r710_device_tokens R710DeviceTokens[]
  r710_token_sales   R710TokenSales[]
  businesses         Businesses         @relation("R710TokenToBusiness", fields: [businessId], references: [id], onDelete: Cascade)
  r710_token_configs R710TokenConfigs   @relation(fields: [tokenConfigId], references: [id], onDelete: Cascade)
  r710_wlans         R710Wlans          @relation(fields: [wlanId], references: [id], onDelete: Cascade)

  @@unique([username, password], name: "r710_tokens_username_password_unique")
  @@index([businessId])
  @@index([wlanId])
  @@index([tokenConfigId])
  @@index([status])
  @@index([username])
  @@index([password])
  @@index([connectedMac])
  @@map("r710_tokens")
}

model R710TokenSales {
  id               String          @id @default(uuid())
  businessId       String
  tokenId          String
  expenseAccountId String
  saleAmount       Decimal         @db.Decimal(12, 2)
  paymentMethod    String          @db.VarChar(50)
  saleChannel      R710SaleChannel @default(DIRECT)
  soldAt           DateTime        @default(now())
  soldBy           String
  receiptPrinted   Boolean         @default(false)
  businesses       Businesses      @relation("R710TokenSaleToBusiness", fields: [businessId], references: [id], onDelete: Cascade)
  expense_accounts ExpenseAccounts @relation("R710TokenSaleToExpenseAccount", fields: [expenseAccountId], references: [id])
  users            Users           @relation("R710TokenSaleSeller", fields: [soldBy], references: [id])
  r710_tokens      R710Tokens      @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([tokenId])
  @@index([expenseAccountId])
  @@index([soldBy])
  @@index([saleChannel])
  @@index([soldAt])
  @@map("r710_token_sales")
}

model R710BusinessTokenMenuItems {
  id                 String           @id @default(uuid())
  businessId         String
  tokenConfigId      String
  businessPrice      Decimal          @db.Decimal(12, 2)
  isActive           Boolean          @default(true)
  displayOrder       Int              @default(0)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @default(now()) @updatedAt
  businesses         Businesses       @relation(fields: [businessId], references: [id], onDelete: Cascade)
  r710_token_configs R710TokenConfigs @relation(fields: [tokenConfigId], references: [id], onDelete: Cascade)

  @@unique([businessId, tokenConfigId])
  @@index([businessId])
  @@index([tokenConfigId])
  @@map("r710_business_token_menu_items")
}

model R710DeviceTokens {
  id          String     @id @default(uuid())
  tokenId     String
  macAddress  String     @db.VarChar(17)
  isOnline    Boolean    @default(false)
  currentIp   String?    @db.VarChar(15)
  firstSeen   DateTime
  lastSeen    DateTime
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  r710_tokens R710Tokens @relation(fields: [tokenId], references: [id], onDelete: Cascade)

  @@unique([tokenId, macAddress])
  @@index([tokenId])
  @@index([macAddress])
  @@index([isOnline])
  @@map("r710_device_tokens")
}

model R710SyncLogs {
  id               String             @id @default(uuid())
  businessId       String
  deviceRegistryId String
  syncType         R710SyncType       @default(TOKEN_SYNC)
  status           R710SyncStatus
  tokensChecked    Int                @default(0)
  tokensUpdated    Int                @default(0)
  errorMessage     String?
  syncDurationMs   Int?
  syncedAt         DateTime           @default(now())
  createdAt        DateTime           @default(now())
  businesses       Businesses         @relation(fields: [businessId], references: [id], onDelete: Cascade)
  device_registry  R710DeviceRegistry @relation(fields: [deviceRegistryId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([deviceRegistryId])
  @@index([syncedAt])
  @@index([status])
  @@index([syncType])
  @@map("r710_sync_logs")
}

model DeviceRegistry {
  id                  String                    @id @default(uuid())
  macAddress          String                    @unique @db.VarChar(17)
  hostname            String?                   @db.VarChar(255)
  deviceType          String?                   @db.VarChar(100)
  manufacturer        String?                   @db.VarChar(100)
  firstSeenAt         DateTime
  firstSeenSystem     String                    @db.VarChar(10)
  firstSeenBusinessId String?
  lastSeenAt          DateTime
  lastSeenSystem      String                    @db.VarChar(10)
  lastSeenBusinessId  String?
  totalConnections    Int                       @default(0)
  esp32Connections    Int                       @default(0)
  r710Connections     Int                       @default(0)
  notes               String?
  tags                String[]
  createdAt           DateTime                  @default(now())
  updatedAt           DateTime                  @updatedAt
  connectionHistory   DeviceConnectionHistory[]
  firstSeenBusiness   Businesses?               @relation("DeviceFirstSeenBusiness", fields: [firstSeenBusinessId], references: [id])
  lastSeenBusiness    Businesses?               @relation("DeviceLastSeenBusiness", fields: [lastSeenBusinessId], references: [id])
  aclEntries          MacAclEntry[]

  @@index([macAddress])
  @@index([firstSeenAt])
  @@index([lastSeenAt])
  @@index([deviceType])
  @@index([firstSeenBusinessId])
  @@index([lastSeenBusinessId])
  @@index([firstSeenSystem])
  @@index([lastSeenSystem])
  @@map("device_registry")
}

model DeviceConnectionHistory {
  id                String         @id @default(uuid())
  deviceId          String
  system            String         @db.VarChar(10)
  businessId        String?
  tokenId           String?
  wlanSsid          String?        @db.VarChar(255)
  ipAddress         String?        @db.VarChar(45)
  signalStrength    Int?
  radioBand         String?        @db.VarChar(10)
  channel           String?        @db.VarChar(10)
  bandwidthUsedDown Decimal?       @db.Decimal(12, 2)
  bandwidthUsedUp   Decimal?       @db.Decimal(12, 2)
  connectedAt       DateTime
  disconnectedAt    DateTime?
  duration          Int?
  createdAt         DateTime       @default(now())
  business          Businesses?    @relation(fields: [businessId], references: [id])
  device            DeviceRegistry @relation(fields: [deviceId], references: [id], onDelete: Cascade)

  @@index([deviceId])
  @@index([businessId])
  @@index([connectedAt])
  @@index([system])
  @@index([tokenId])
  @@map("device_connection_history")
}

model MacAclEntry {
  id         String          @id @default(uuid())
  macAddress String          @db.VarChar(17)
  deviceId   String?
  listType   MacAclListType
  system     String          @db.VarChar(10)
  businessId String?
  r710WlanId String?
  r710AclId  String?         @db.VarChar(50)
  reason     String?         @db.VarChar(255)
  notes      String?
  createdBy  String
  approvedBy String?
  expiresAt  DateTime?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  approver   Users?          @relation("MacAclApprover", fields: [approvedBy], references: [id])
  business   Businesses?     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  creator    Users           @relation("MacAclCreator", fields: [createdBy], references: [id])
  device     DeviceRegistry? @relation(fields: [deviceId], references: [id])
  r710Wlan   R710Wlans?      @relation(fields: [r710WlanId], references: [id], onDelete: Cascade)

  @@unique([macAddress, system, businessId, listType])
  @@index([macAddress])
  @@index([listType])
  @@index([system])
  @@index([businessId])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("mac_acl_entries")
}

model R710ConnectedClients {
  id               String             @id @default(uuid())
  deviceRegistryId String
  wlanId           String
  businessId       String
  macAddress       String             @db.VarChar(17)
  ipAddress        String?            @db.VarChar(45)
  hostname         String?            @db.VarChar(255)
  deviceType       String?            @db.VarChar(100)
  tokenUsername    String?            @db.VarChar(50)
  connectedAt      DateTime
  signalStrength   Int?
  radioBand        String?            @db.VarChar(10)
  channel          String?            @db.VarChar(10)
  rxBytes          BigInt             @default(0)
  txBytes          BigInt             @default(0)
  rxPackets        Int                @default(0)
  txPackets        Int                @default(0)
  lastSyncedAt     DateTime           @default(now())
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  business         Businesses         @relation(fields: [businessId], references: [id], onDelete: Cascade)
  deviceRegistry   R710DeviceRegistry @relation(fields: [deviceRegistryId], references: [id], onDelete: Cascade)
  wlan             R710Wlans          @relation(fields: [wlanId], references: [id], onDelete: Cascade)

  @@unique([deviceRegistryId, macAddress])
  @@index([deviceRegistryId])
  @@index([wlanId])
  @@index([businessId])
  @@index([macAddress])
  @@index([connectedAt])
  @@index([lastSyncedAt])
  @@map("r710_connected_clients")
}

model ESP32ConnectedClients {
  id                String     @id @default(uuid())
  macAddress        String     @db.VarChar(17)
  ipAddress         String?    @db.VarChar(15)
  hostname          String?    @db.VarChar(255)
  deviceType        String?    @db.VarChar(100)
  wifiTokenId       String
  businessId        String
  connectedAt       DateTime
  isOnline          Boolean    @default(true)
  bandwidthUsedDown Decimal    @default(0) @db.Decimal(12, 2)
  bandwidthUsedUp   Decimal    @default(0) @db.Decimal(12, 2)
  lastSyncedAt      DateTime   @default(now())
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  business          Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)
  wifiToken         WifiTokens @relation(fields: [wifiTokenId], references: [id], onDelete: Cascade)

  @@unique([wifiTokenId, macAddress])
  @@index([wifiTokenId])
  @@index([businessId])
  @@index([macAddress])
  @@index([connectedAt])
  @@index([lastSyncedAt])
  @@index([isOnline])
  @@map("esp32_connected_clients")
}

model WiFiUsageAnalytics {
  id                    String      @id @default(uuid())
  periodType            String      @db.VarChar(10)
  periodStart           DateTime
  periodEnd             DateTime
  system                String      @db.VarChar(10)
  businessId            String?
  uniqueDevices         Int         @default(0)
  totalConnections      Int         @default(0)
  avgConnectionDuration Decimal?    @db.Decimal(12, 2)
  tokensGenerated       Int         @default(0)
  tokensSold            Int         @default(0)
  tokensUsed            Int         @default(0)
  tokensExpired         Int         @default(0)
  totalRevenue          Decimal     @default(0) @db.Decimal(12, 2)
  esp32Revenue          Decimal     @default(0) @db.Decimal(12, 2)
  r710Revenue           Decimal     @default(0) @db.Decimal(12, 2)
  totalBandwidthDown    Decimal     @default(0) @db.Decimal(12, 2)
  totalBandwidthUp      Decimal     @default(0) @db.Decimal(12, 2)
  deviceTypeStats       Json?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
  business              Businesses? @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([periodType, periodStart, system, businessId])
  @@index([periodStart])
  @@index([periodEnd])
  @@index([system])
  @@index([businessId])
  @@index([periodType])
  @@map("wifi_usage_analytics")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model BarcodeTemplates {
  id              String                  @id @default(cuid())
  barcodeValue    String
  type            String
  description     String
  extraInfo       Json?
  symbology       String                  @default("CODE128")
  dpi             Int                     @default(300)
  quietZone       Int                     @default(10)
  paperSize       String                  @default("A6")
  orientation     String                  @default("portrait")
  layoutTemplate  Json
  businessId      String
  createdAt       DateTime                @default(now())
  updatedBy       String?
  updatedAt       DateTime                @updatedAt
  name            String
  width           Int?                    @db.SmallInt
  height          Int?                    @db.SmallInt
  margin          Int?                    @db.SmallInt
  displayValue    Boolean?                @default(true)
  fontSize        Int?                    @db.SmallInt
  backgroundColor String?
  lineColor       String?
  createdById     String
  sku             String?
  batchId         String?
  defaultPrice    Decimal?                @db.Decimal(10, 2)
  productName     String?
  defaultColor    String?
  defaultSize     String?
  inventoryItems  BarcodeInventoryItems[]
  printJobs       BarcodePrintJobs[]
  business        Businesses              @relation(fields: [businessId], references: [id])
  createdBy       Users                   @relation(fields: [createdById], references: [id])

  @@unique([businessId, barcodeValue], name: "barcode_templates_business_value_unique")
  @@map("barcode_templates")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model BarcodePrintJobs {
  id                    String                  @id @default(cuid())
  templateId            String
  requestedQuantity     Int
  printedQuantity       Int                     @default(0)
  status                BarcodePrintJobStatus   @default(QUEUED)
  printerId             String?
  printSettings         Json
  printedAt             DateTime?
  userNotes             String?
  businessId            String
  createdAt             DateTime                @default(now())
  itemId                String?
  itemType              String?
  barcodeData           String?
  itemName              String?
  customData            Json?
  errorMessage          String?
  inventoryItemId       String?
  createdById           String
  business              Businesses              @relation(fields: [businessId], references: [id])
  createdBy             Users                   @relation(fields: [createdById], references: [id])
  inventoryItem         BarcodeInventoryItems?  @relation(fields: [inventoryItemId], references: [id])
  printer               NetworkPrinters?        @relation(fields: [printerId], references: [id])
  template              BarcodeTemplates        @relation(fields: [templateId], references: [id])
  product_price_changes product_price_changes[]

  @@map("barcode_print_jobs")
}

model BarcodeInventoryItems {
  id                String             @id @default(cuid())
  name              String
  sku               String?
  category          String?
  barcodeTemplateId String
  location          String?
  stockQuantity     Int                @default(0)
  businessId        String
  inventoryItemId   String
  barcodeData       String?
  customLabel       String?
  batchNumber       String?
  expiryDate        DateTime?
  quantity          Int                @default(1)
  isActive          Boolean            @default(true)
  createdById       String
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  barcodeTemplate   BarcodeTemplates   @relation(fields: [barcodeTemplateId], references: [id])
  business          Businesses         @relation(fields: [businessId], references: [id])
  createdBy         Users              @relation(fields: [createdById], references: [id])
  printJobs         BarcodePrintJobs[]

  @@map("barcode_inventory_items")
}

model sku_sequences {
  id              String     @id @default(uuid())
  businessId      String
  prefix          String     @db.VarChar(20)
  currentSequence Int        @default(0)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @default(now())
  business        Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, prefix])
  @@index([businessId])
  @@index([businessId, prefix])
  @@map("sku_sequences")
}

model product_price_changes {
  id           String            @id @default(uuid())
  productId    String
  variantId    String?
  oldPrice     Decimal?          @db.Decimal(10, 2)
  newPrice     Decimal           @db.Decimal(10, 2)
  changedBy    String?
  changedAt    DateTime          @default(now())
  changeReason String            @default("MANUAL_EDIT") @db.VarChar(100)
  barcodeJobId String?
  notes        String?
  barcodeJob   BarcodePrintJobs? @relation(fields: [barcodeJobId], references: [id])
  user         Users?            @relation(fields: [changedBy], references: [id])
  product      BusinessProducts  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([changedAt(sort: Desc)])
  @@index([changedBy])
  @@index([variantId])
  @@index([changeReason])
  @@map("product_price_changes")
}

model Permissions {
  id                 String            @id @default(uuid())
  name               String            @unique
  description        String?
  category           String?
  isSystemPermission Boolean           @default(false)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  userPermissions    UserPermissions[]

  @@map("permissions")
}

model UserPermissions {
  id           String      @id @default(uuid())
  userId       String
  permissionId String
  granted      Boolean     @default(true)
  grantedAt    DateTime    @default(now())
  grantedBy    String?
  expiresAt    DateTime?
  permission   Permissions @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  users        Users       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionId])
  @@map("user_permissions")
}

model CustomerDisplaySession {
  id             String     @id @default(uuid())
  businessId     String
  terminalId     String
  isActive       Boolean    @default(true)
  connectionType String
  lastHeartbeat  DateTime   @default(now())
  createdAt      DateTime   @default(now())
  businesses     Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId, terminalId])
  @@index([isActive])
  @@map("customer_display_sessions")
}

model CustomerDisplayAd {
  id         String     @id @default(uuid())
  businessId String
  title      String
  imageUrl   String?
  videoUrl   String?
  duration   Int        @default(10)
  isActive   Boolean    @default(true)
  sortOrder  Int        @default(0)
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  businesses Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId, isActive, sortOrder])
  @@map("customer_display_ads")
}

model PosTerminalConfig {
  id                 String     @id @default(uuid())
  businessId         String
  terminalId         String     @unique
  displayName        String
  hasCustomerDisplay Boolean    @default(false)
  customerDisplayUrl String?
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  businesses         Businesses @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@map("pos_terminal_configs")
}

enum AttributeDataType {
  TEXT
  NUMBER
  BOOLEAN
  DATE
  LIST
  JSON
}

enum AuthorizationLevel {
  BASIC
  ADVANCED
  EMERGENCY
}

enum ConflictType {
  UPDATE_UPDATE
  UPDATE_DELETE
  DELETE_UPDATE
  VECTOR_CLOCK
  TIMESTAMP
}

enum CustomerType {
  INDIVIDUAL
  BUSINESS
  CONTRACTOR
  WHOLESALE
  VIP
}

enum DriveType {
  LEFT_HAND
  RIGHT_HAND
}

enum ExpenseType {
  FUEL
  TOLL
  PARKING
  MAINTENANCE
  INSURANCE
  OTHER
  FOOD
  TIRE
  OIL
}

enum FuelType {
  GASOLINE
  DIESEL
  ELECTRIC
  HYBRID
}

enum ImageSize {
  THUMBNAIL
  SMALL
  MEDIUM
  LARGE
  ORIGINAL
}

enum LicenseType {
  REGISTRATION
  RADIO
  ROAD_USE
  INSURANCE
  INSPECTION
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  READY
  COMPLETED
  CANCELLED
  REFUNDED
}

enum OrderType {
  SALE
  RETURN
  EXCHANGE
  SERVICE
  KITCHEN_TICKET
  RENTAL
  SUBSCRIPTION
}

enum OwnershipType {
  PERSONAL
  BUSINESS
}

enum PaymentMethod {
  CASH
  CARD
  MOBILE_MONEY
  BANK_TRANSFER
  STORE_CREDIT
  LAYAWAY
  NET_30
  CHECK
  EXPENSE_ACCOUNT
}

enum PaymentStatus {
  PENDING
  PAID
  PARTIALLY_PAID
  OVERDUE
  REFUNDED
  FAILED
}

enum ProductCondition {
  NEW
  USED
  REFURBISHED
  DAMAGED
  EXPIRED
}

enum ProductType {
  PHYSICAL
  DIGITAL
  SERVICE
  COMBO
}

enum BarcodeType {
  UPC_A
  UPC_E
  EAN_13
  EAN_8
  CODE128
  CODE39
  ITF
  CODABAR
  QR_CODE
  DATA_MATRIX
  PDF417
  CUSTOM
  SKU_BARCODE
}

enum PromotionType {
  PERCENTAGE
  FIXED_AMOUNT
  BUY_ONE_GET_ONE
  COMBO_DEAL
  HAPPY_HOUR
  CATEGORY_DISCOUNT
}

enum ReimbursementStatus {
  PENDING
  APPROVED
  PAID
  REJECTED
}

enum ResolutionStrategy {
  LATEST_TIMESTAMP
  HIGHEST_PRIORITY
  MANUAL_RESOLUTION
  SOURCE_WINS
  TARGET_WINS
  MERGE_FIELDS
  LAST_WRITER_WINS
  NODE_PRIORITY
  MERGE_CHANGES
  BUSINESS_RULE
  KEEP_BOTH
}

enum ServiceType {
  OIL_CHANGE
  TIRE_REPLACEMENT
  BRAKE_SERVICE
  INSPECTION
  REPAIR
  OTHER
}

enum StockMovementType {
  PURCHASE_RECEIVED
  SALE
  RETURN_IN
  RETURN_OUT
  ADJUSTMENT
  TRANSFER_IN
  TRANSFER_OUT
  DAMAGE
  THEFT
  EXPIRED
  PRODUCTION_IN
  PRODUCTION_OUT
}

enum SyncOperation {
  CREATE
  UPDATE
  DELETE
  TRUNCATE
  UPSERT
}

enum TripType {
  BUSINESS
  PERSONAL
  MIXED
}

enum LaybyStatus {
  ACTIVE
  COMPLETED
  CANCELLED
  DEFAULTED
  ON_HOLD
}

enum InstallmentFrequency {
  WEEKLY
  FORTNIGHTLY
  MONTHLY
  CUSTOM
}

enum WifiTokenStatus {
  ACTIVE
  EXPIRED
  DISABLED
  UNUSED
  SOLD
}

enum R710TokenStatus {
  AVAILABLE
  SOLD
  ACTIVE
  EXPIRED
  INVALIDATED
}

enum R710ConnectionStatus {
  CONNECTED
  DISCONNECTED
  ERROR
}

enum R710SaleChannel {
  DIRECT
  POS
}

enum R710SyncType {
  TOKEN_SYNC
  AUTO_GENERATION
  HEALTH_CHECK
}

enum R710SyncStatus {
  SUCCESS
  DEVICE_UNREACHABLE
  ERROR
}

enum MacAclListType {
  BLACKLIST
  WHITELIST
}

enum BarcodePrintJobStatus {
  QUEUED
  PRINTING
  COMPLETED
  FAILED
  CANCELLED
}

enum TransferStatus {
  PENDING
  COMPLETED
  CANCELLED
}

// ============================================================
// Coupon & Inventory Transfer Models (MBM-123)
// ============================================================

model Coupons {
  id               String   @id @default(uuid())
  businessId       String
  code             String
  barcode          String?
  description      String?
  discountAmount   Decimal  @db.Decimal(10, 2)
  requiresApproval Boolean  @default(false)
  isActive         Boolean  @default(true)
  createdBy        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  businesses    Businesses     @relation(fields: [businessId], references: [id])
  employees     Employees?     @relation("CouponCreatedBy", fields: [createdBy], references: [id])
  coupon_usages CouponUsages[]

  @@unique([businessId, code])
  @@map("coupons")
}

model CouponUsages {
  id            String   @id @default(uuid())
  couponId      String
  orderId       String
  appliedAmount Decimal  @db.Decimal(10, 2)
  approvedBy    String?
  customerPhone String?
  createdAt     DateTime @default(now())

  coupons   Coupons        @relation(fields: [couponId], references: [id])
  orders    BusinessOrders @relation(fields: [orderId], references: [id])
  employees Employees?     @relation("CouponApprovedBy", fields: [approvedBy], references: [id])

  @@unique([couponId, customerPhone])
  @@map("coupon_usages")
}

model InventoryTransfers {
  id               String         @id @default(uuid())
  sourceBusinessId String
  targetBusinessId String
  status           TransferStatus @default(PENDING)
  transferDate     DateTime       @default(now())
  employeeId       String?
  notes            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt

  sourceBusiness Businesses               @relation("TransferSource", fields: [sourceBusinessId], references: [id])
  targetBusiness Businesses               @relation("TransferTarget", fields: [targetBusinessId], references: [id])
  employees      Employees?               @relation("TransferEmployee", fields: [employeeId], references: [id])
  items          InventoryTransferItems[]

  @@map("inventory_transfers")
}

model InventoryTransferItems {
  id               String   @id @default(uuid())
  transferId       String
  productVariantId String?
  quantity         Int
  sourcePrice      Decimal  @db.Decimal(10, 2)
  targetPrice      Decimal  @db.Decimal(10, 2)
  productName      String
  barcode          String?
  baleId           String?
  createdAt        DateTime @default(now())

  transfer        InventoryTransfers @relation(fields: [transferId], references: [id])
  productVariants ProductVariants?   @relation(fields: [productVariantId], references: [id])
  bale            ClothingBales?     @relation(fields: [baleId], references: [id])

  @@map("inventory_transfer_items")
}

// ============================================================
// Clothing Bale System (MBM-123 - Bale Enhancement)
// ============================================================

model ClothingBaleCategories {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  bales ClothingBales[]

  @@map("clothing_bale_categories")
}

model ClothingBales {
  id             String   @id @default(uuid())
  businessId     String
  categoryId     String
  batchNumber    String
  itemCount      Int
  remainingCount Int
  unitPrice      Decimal  @db.Decimal(10, 2)
  sku            String   @unique
  barcode        String?
  bogoActive     Boolean  @default(false)
  bogoRatio      Int      @default(1)
  isActive       Boolean  @default(true)
  employeeId     String?
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  business                 Businesses               @relation(fields: [businessId], references: [id])
  category                 ClothingBaleCategories   @relation(fields: [categoryId], references: [id])
  employee                 Employees?               @relation("BaleStockedBy", fields: [employeeId], references: [id])
  inventory_transfer_items InventoryTransferItems[]

  @@unique([businessId, batchNumber])
  @@map("clothing_bales")
}
