// Expense Account Types

export interface ExpenseAccount {
  id: string
  accountNumber: string
  accountName: string
  balance: number
  description?: string | null
  isActive: boolean
  lowBalanceThreshold: number
  createdBy: string
  createdAt: string
  updatedAt: string
  creator?: {
    id: string
    name: string
    email: string
  }
  deposits?: ExpenseAccountDeposit[]
  payments?: ExpenseAccountPayment[]
}

export interface ExpenseAccountDeposit {
  id: string
  expenseAccountId: string
  sourceType: DepositSourceType
  sourceBusinessId?: string | null
  amount: number
  depositDate: string
  autoGeneratedNote?: string | null
  manualNote?: string | null
  transactionType?: string | null
  createdBy: string
  createdAt: string
  expenseAccount?: ExpenseAccount
  sourceBusiness?: {
    id: string
    name: string
    type: string
  } | null
  creator?: {
    id: string
    name: string
    email: string
  }
}

export interface ExpenseAccountPayment {
  id: string
  expenseAccountId: string
  payeeType: PayeeType
  payeeUserId?: string | null
  payeeEmployeeId?: string | null
  payeePersonId?: string | null
  payeeBusinessId?: string | null
  categoryId: string
  subcategoryId?: string | null
  amount: number
  paymentDate: string
  notes?: string | null
  receiptNumber?: string | null
  receiptServiceProvider?: string | null
  receiptReason?: string | null
  isFullPayment: boolean
  batchId?: string | null
  status: PaymentStatus
  createdBy: string
  submittedBy?: string | null
  submittedAt?: string | null
  createdAt: string
  updatedAt: string
  expenseAccount?: ExpenseAccount
  payeeUser?: {
    id: string
    name: string
    email: string
  } | null
  payeeEmployee?: {
    id: string
    fullName: string
    employeeNumber: string
  } | null
  payeePerson?: {
    id: string
    fullName: string
    nationalId?: string | null
  } | null
  payeeBusiness?: {
    id: string
    name: string
    type: string
  } | null
  category?: {
    id: string
    name: string
    emoji?: string
    color?: string
  }
  subcategory?: {
    id: string
    name: string
    emoji?: string | null
  } | null
  creator?: {
    id: string
    name: string
    email: string
  }
  submitter?: {
    id: string
    name: string
    email: string
  } | null
}

// Enum Types
export type DepositSourceType = 'BUSINESS' | 'MANUAL' | 'OTHER'

export type PayeeType = 'USER' | 'EMPLOYEE' | 'PERSON' | 'BUSINESS'

export type PaymentStatus = 'DRAFT' | 'SUBMITTED'

// Balance Summary Type
export interface BalanceSummary {
  totalDeposits: number
  totalPayments: number
  currentBalance: number
  depositCount: number
  paymentCount: number
  pendingPayments: number
}

// Payment Batch Type (for batch processing UI)
export interface PaymentBatch {
  payments: Omit<ExpenseAccountPayment, 'id' | 'expenseAccountId' | 'batchId' | 'status' | 'submittedBy' | 'submittedAt' | 'createdAt' | 'updatedAt'>[]
  totalAmount: number
  runningBalance: number
}

// Form Input Types
export interface CreateExpenseAccountInput {
  accountName: string
  description?: string
  lowBalanceThreshold?: number
}

export interface CreateDepositInput {
  sourceType: DepositSourceType
  sourceBusinessId?: string
  amount: number
  depositDate: string
  manualNote?: string
  transactionType?: string
}

export interface CreatePaymentInput {
  payeeType: PayeeType
  payeeUserId?: string
  payeeEmployeeId?: string
  payeePersonId?: string
  payeeBusinessId?: string
  categoryId: string
  subcategoryId?: string
  amount: number
  paymentDate: string
  notes?: string
  receiptNumber?: string
  receiptServiceProvider?: string
  receiptReason?: string
  isFullPayment?: boolean
  status?: PaymentStatus
}

export interface BatchPaymentInput {
  expenseAccountId: string
  payments: CreatePaymentInput[]
}

// Transaction Type (combines deposits and payments for history view)
export interface ExpenseAccountTransaction {
  id: string
  type: 'DEPOSIT' | 'PAYMENT'
  amount: number
  date: string
  description: string
  balanceAfter?: number
  createdBy: string
  createdAt: string
  // Deposit-specific fields
  sourceType?: DepositSourceType
  sourceBusiness?: {
    id: string
    name: string
  }
  // Payment-specific fields
  payeeType?: PayeeType
  payeeName?: string
  category?: {
    name: string
    emoji?: string
  }
  receiptNumber?: string
  status?: PaymentStatus
}

// Report Types
export interface ExpenseReportData {
  byCategory: Array<{
    categoryId: string
    categoryName: string
    emoji?: string
    totalAmount: number
    paymentCount: number
    percentage: number
  }>
  byPayee: Array<{
    payeeType: PayeeType
    payeeId: string
    payeeName: string
    totalAmount: number
    paymentCount: number
  }>
  trends: Array<{
    period: string // e.g., "2025-01", "2025-02"
    totalAmount: number
    paymentCount: number
  }>
  summary: {
    totalSpent: number
    averagePayment: number
    totalPayments: number
    mostExpensiveCategory: string
    mostFrequentPayee: string
  }
}

// Payee-specific report (for bidirectional navigation)
export interface PayeeExpenseReport {
  payee: {
    id: string
    type: PayeeType
    name: string
    identifier?: string // employee number, national ID, etc.
  }
  totalPaid: number
  paymentCount: number
  accountsCount: number
  accountBreakdown: Array<{
    accountId: string
    accountName: string
    accountNumber: string
    totalPaid: number
    paymentCount: number
    payments: ExpenseAccountPayment[]
  }>
  byCategory: Array<{
    categoryName: string
    emoji?: string
    totalAmount: number
    paymentCount: number
  }>
  trends: Array<{
    period: string
    totalAmount: number
    paymentCount: number
  }>
}

export default ExpenseAccount
